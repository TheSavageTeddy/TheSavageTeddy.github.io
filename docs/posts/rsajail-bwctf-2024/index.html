<!DOCTYPE html>
<html lang="en">

<head>
  

  
  
  

  <title>RSAjail Writeups - Blue Water CTF 2024 :: teddyctf</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Writeups for all RSAjail challenges: Pyjail &#43; RSA = 3 million lines of Python code" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://TheSavageTeddy.github.io/posts/rsajail-bwctf-2024/" />


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-J6PB683BSR"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-J6PB683BSR');
        }
      </script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
    integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
    integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4"
    crossorigin="anonymous"></script>




<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
    integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
    onload="renderMathInElement(document.body, { delimiters: [{left: '$$', right: '$$', display: true}, {left: '\$', right: '\$', display: false}] });">
    </script>




  
  
  
  
  
  <link rel="stylesheet" href="https://TheSavageTeddy.github.io/styles.css">







  <link rel="shortcut icon" href="https://TheSavageTeddy.github.io/favicon.ico">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="teddyctf" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="RSAjail Writeups - Blue Water CTF 2024">
<meta property="og:description" content="Writeups for all RSAjail challenges: Pyjail &#43; RSA = 3 million lines of Python code" />
<meta property="og:url" content="https://TheSavageTeddy.github.io/posts/rsajail-bwctf-2024/" />
<meta property="og:site_name" content="teddyctf" />

  
  
    
  
  <meta property="og:image" content="https://TheSavageTeddy.github.io/posts/rsajail-bwctf-2024/bw-misc.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">

  <meta property="article:section" content="CTF Writeups" />

  <meta property="article:section" content="writeups" />


  <meta property="article:published_time" content="2024-10-15 22:00:00 &#43;1100 AEDT" />












</head>

<body class="green">
  

  <div class="container center headings--one-size">

    <header class="header">
  <div class="header__inner" style="height: 34px;">
    <img src="/images/teddypfp.jpg" style="max-height: 100%; max-width: 100%; display: block;">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    teddy / TheSavageTeddy
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;â–¾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/contact">Contact</a></li>
        
      
        
          <li><a href="/featured">Featured Posts</a></li>
        
      
        
          <li><a href="/posts">Other Posts</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          
            <li><a href="/about">About</a></li>
          
        
      
        
          
            <li><a href="/contact">Contact</a></li>
          
        
      
        
          
            <li><a href="/featured"><b>Featured Posts</b></a></li>
          
        
      
        
          
            <li><a href="/posts">Other Posts</a></li>
          
        
      
      
    
  </ul>
</nav>

  
</header>


    <div class="content">
      
<article class="post">
  <h1 class="post-title">
    <a href="https://TheSavageTeddy.github.io/posts/rsajail-bwctf-2024/">
  <img src="https://ctftime.org/media/cache/48/72/4872c3c168bd1cdeb5dc564bb3a0416f.png"  class="left"  style="border-radius: 5px; height: auto; width: 3em; display: inline; vertical-align: middle; "  />


 RSAjail Writeups - Blue Water CTF 2024</a>
  </h1>
  <div class="post-meta">
    
      <time class="post-date">
        Oct 15, 2024 :: teddyctf
        
      </time>
    
    
    
  </div>

  
    <span class="post-tags">
      
      #<a href="https://TheSavageTeddy.github.io/tags/ctf/">ctf</a>&nbsp;
      
      #<a href="https://TheSavageTeddy.github.io/tags/misc/">misc</a>&nbsp;
      
      #<a href="https://TheSavageTeddy.github.io/tags/writeup/">writeup</a>&nbsp;
      
    </span>
  
  
  <img src="/posts/rsajail-bwctf-2024/bw-misc.png"
    class="post-cover"
    alt=" "
    title="Cover Image" 
    style="border: 1.5px solid #78E2A0; border-radius: 5px; padding: 0px; display:block; margin: auto; max-height: 40em; max-width: auto; " />


  

  <div class="post-content"><div>
        <h1 id="overview">Overview<a href="#overview" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Last weekend I played <a href="https://ctftime.org/event/2479">Blue Water CTF</a> with my team <a href="https://ctftime.org/team/160273">Emu Exploit</a>. We just mananged to get top 10!</p>

  <img src="./img/bw-scoreboard.png"  class="center"  style="border-radius: 5px; width: 100%"  />


<p>I wasn&rsquo;t planning on playing CTFs at all, but the series of misc challenges, RSAjail, caught my attention, so I proceeded to spend the entirely of Sunday solving them.</p>
<p>In this post, I will go through each of the challenges, RSAjail-3, RSAjail-2, and RSAjail-1, all made by <a href="https://x.com/ah_p_uh">soon haari</a>. I recommend reading in order, since some techniques from the previous parts may be used in later parts.</p>
<h1 id="challenges-overview">Challenges Overview<a href="#challenges-overview" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>

  <img src="./img/bw-misc.png"  class="center"  style="border-radius: 5px; width: 100%"  />


<h1 id="rsajail-3---63-solves">RSAjail-3 - 63 solves<a href="#rsajail-3---63-solves" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<blockquote>
<p>Let&rsquo;s learn about RSA!</p>
<p><code>nc rsajail3.chal.perfect.blue 1337</code></p></blockquote>
<p>We are given the Python source file that runs on the server:</p>



  <div class="collapsable-code">
    <input id="573289146" type="checkbox"  />
    <label for="573289146">
      <span class="collapsable-code__language">python</span>
      <span class="collapsable-code__title">rsajail-3.py</span>
      <span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide"></span>
    </label>
    <pre class="language-python" ><code>
from subprocess import Popen, PIPE, DEVNULL
from Crypto.Util.number import getPrime
from secret import fname, flag
import time, string, secrets, os

def keygen():
    pr = Popen([&#39;python3&#39;, &#39;-i&#39;], stdin=PIPE, stdout=DEVNULL, stderr=DEVNULL, text=True, bufsize=1)

    p, q = getPrime(1024), getPrime(1024)
    N, e = p * q, 0x10001
    m = secrets.randbelow(N)
    c = pow(m, e, N)

    pr.stdin.write(f&#34;{(N, p, c) = }\n&#34;)
    pr.stdin.write(f&#34;X = lambda m: open(&#39;{fname}&#39;, &#39;w&#39;).write(str(m))\n&#34;)
    # X marks the spot!
    
    return pr, m

def verify(pr, m, msg):
    time.sleep(1)

    assert int(open(fname, &#39;r&#39;).read()) == m
    os.remove(fname)
    pr.kill()

    print(msg)

# Example!
pr, m = keygen()
example = [
    &#34;q = N // p&#34;,
    &#34;phi = (p - 1) * (q - 1)&#34;,
    &#34;d = pow(0x10001, -1, phi)&#34;,
    &#34;m = pow(c, d, N)&#34;,
    &#34;X(m)&#34;
]

for code in example:
    pr.stdin.write(code &#43; &#39;\n&#39;)

verify(pr, m, &#34;I showed you how RSA works, try yourself!&#34;)


# Your turn!
pr, m = keygen()
while code := input(&#34;&gt;&gt;&gt; &#34;):
    if (len(code) &gt; 3) or any(c == &#34;\\&#34; or c not in string.printable for c in code):
        print(&#39;No hack :(&#39;)
        continue
    pr.stdin.write(code &#43; &#39;\n&#39;)

verify(pr, m, flag)

</code></pre>
  </div>


<p>Basically, it generates RSA values <code>N</code>, <code>p</code>, <code>c</code>, and writes it to a Python interpreter. It also defines the function <code>X(m)</code> as writing <code>m</code> to a file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">keygen</span>():
</span></span><span style="display:flex;"><span>    pr <span style="color:#f92672">=</span> Popen([<span style="color:#e6db74">&#39;python3&#39;</span>, <span style="color:#e6db74">&#39;-i&#39;</span>], stdin<span style="color:#f92672">=</span>PIPE, stdout<span style="color:#f92672">=</span>DEVNULL, stderr<span style="color:#f92672">=</span>DEVNULL, text<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, bufsize<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    p, q <span style="color:#f92672">=</span> getPrime(<span style="color:#ae81ff">1024</span>), getPrime(<span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>    N, e <span style="color:#f92672">=</span> p <span style="color:#f92672">*</span> q, <span style="color:#ae81ff">0x10001</span>
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> secrets<span style="color:#f92672">.</span>randbelow(N)
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> pow(m, e, N)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    pr<span style="color:#f92672">.</span>stdin<span style="color:#f92672">.</span>write(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>(N, p, c) <span style="color:#e6db74">= }</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    pr<span style="color:#f92672">.</span>stdin<span style="color:#f92672">.</span>write(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;X = lambda m: open(&#39;</span><span style="color:#e6db74">{</span>fname<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;, &#39;w&#39;).write(str(m))</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># X marks the spot!</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> pr, m
</span></span></code></pre></div><p>Like this:</p>

  <img src="./img/t1.png"  class="center"  style="border-radius: 5px; width: 100%"  />


<p>We can input characters into interpreter, and our goal is to decrypt find <code>m</code> by decrypting <code>c</code>, and write it to a file. If the written value is equal to <code>m</code> meaning we successfully decrypted, we get the flag.</p>
<p>The server gives us an example of how to do this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>example <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;q = N // p&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;phi = (p - 1) * (q - 1)&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;d = pow(0x10001, -1, phi)&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;m = pow(c, d, N)&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;X(m)&#34;</span>
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>It seems simple enough. We find <code>q</code> by dividing <code>N</code> by <code>p</code>, calculate <code>d = pow(e, -1, (p-1)*(q-1))</code> and <code>m = pow(c, d, N)</code>.</p>
<p>But the trick is, <strong>each line of our input must be 3 characters or less</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#75715e"># Your turn!</span>
</span></span><span style="display:flex;"><span>pr, m <span style="color:#f92672">=</span> keygen()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> code <span style="color:#f92672">:=</span> input(<span style="color:#e6db74">&#34;&gt;&gt;&gt; &#34;</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (len(code) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">or</span> any(c <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">or</span> c <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> string<span style="color:#f92672">.</span>printable <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> code):
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#39;No hack :(&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    pr<span style="color:#f92672">.</span>stdin<span style="color:#f92672">.</span>write(code <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>verify(pr, m, flag)
</span></span></code></pre></div><p>You might see why this challenge, the easiest one, is called RSAjail-3 and not RSAjail-1.</p>
<p>So with the 3 character restriction, my first thought was how to get multiline input. <code>\</code> is banned, and we also can&rsquo;t use <code>if</code>/<code>for</code>/<code>while</code> statements, since those would be longer than 3 characters.</p>
<p>But there is something we can use that allows the interpreter to keep taking input for the same chunk of code, despite pressing enter - brackets.</p>
<p>If you enter any bracket (<code>[</code>, <code>(</code> <code>{</code>), but don&rsquo;t close it, the interpreter will keep requesting input, even newlines, until you close that bracket and any other brackets.</p>
<p>What&rsquo;s even better is that you can use operators within the brackets, across multiple lines:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> [
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> ]
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>This also works with the walrus operator <code>:=</code>, which allows you to simultaneously assign and use a value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> [
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> a
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">:=</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> ]
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> a
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>This allows us to assign variables!</p>
<p>Using this, we can easily calculate <code>q</code> and totient(<code>N</code>).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> [
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> q
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">:=</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> N<span style="color:#f92672">//</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> p
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> ]
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">91626188501171632213608812997587612695436932752806703465409540571820540906554149309244741450621658939480220966409120116938831715942853207836601892475627420413669286617497654823778323191912299860409614215694474166835113649175038751310702932807349441577883399801632439533079906231771493803222831648878548449211</span>]
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> [
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> Q
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">:=</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> q
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> P
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">:=</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> p
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> ]
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">91626188501171632213608812997587612695436932752806703465409540571820540906554149309244741450621658939480220966409120116938831715942853207836601892475627420413669286617497654823778323191912299860409614215694474166835113649175038751310702932807349441577883399801632439533079906231771493803222831648878548449210</span>, <span style="color:#ae81ff">127750039639135452291469296916511977665182772707105105835394106177575972384328835138779199129021442655142693779106301590855325753788389240229980104156282497542563222917610576834540409259922996468593794837650648556603624289477044475006719950179505258557714249124259038486981185420780664515251860649232946903548</span>]
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> [
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> tn
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">:=</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> Q<span style="color:#f92672">*</span>P
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> ]
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">11705249213007572990421936617184443719758720950917684036355748809266328313342432732406332612303140287972574727994610020444810735156684731143533051392788629946495317141341719946160252009280014244749469641884684973607977218179289278253741577877160090079277005724555263317605894461607314280682159742910037955412117000975604468533979539203011161347521916591546685760837414004640079221338837551868970422318034227972970869199303925502934739469307563027000999481400011577091796266839247077556279926204231514294027076386121125282895365411259105559248355360129100123018102383167074612615423808066046773408727165254366846797080</span>]
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>However, we encounter a problem when we try to use the <code>pow</code> function to calculate <code>d</code>, since its already 3 characters long. But we can simply assign <code>pow</code> to a one character variable, and call the variable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> [
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> a
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">:=</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> pow
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> ,
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">:=</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> a(
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">**</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> tn)
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> ]
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">&lt;</span>built<span style="color:#f92672">-</span><span style="color:#f92672">in</span> function pow<span style="color:#f92672">&gt;</span>, <span style="color:#ae81ff">11648274153133770164782304077079131643426221263972252582251998502261797151831282755421764809331922475868522797966835166598557555662429845670673643067807328194005395323619089849225312656075559897677203886421950724152235503840836293226002383783093927930638994145964038070824438485086375982384440760381263337901756970407967594318462511066145565417438765220676743701272479157645554216050113790039069731643766975600671592343869927116749284201432788279825917942199764332129526358098814652853585977801662738593891357061660551271798677714748864707921620456793866851137442989843756535782118649227939003435774726697274776300593</span>]
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> d <span style="color:#f92672">==</span> pow(<span style="color:#ae81ff">0x10001</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, (p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>(q<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>Doing the same for <code>m = pow(c,d,n)</code>, we can get the flag.</p>
<p>Payload:</p>



  <div class="collapsable-code">
    <input id="987214653" type="checkbox" checked />
    <label for="987214653">
      <span class="collapsable-code__language">text</span>
      <span class="collapsable-code__title">rsajail-3-sol.txt</span>
      <span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide"></span>
    </label>
    <pre class="language-text" ><code>
[
q:=
N//
p,
a:=
pow
,
x:=
p-1
,
y:=
q-1
,
t:=
x*y
,
e:=
2**
16
&#43;1
,
d:=
a(
e,
-1,
t
)
,
m:=
a(
c,
d,
N,
)
,
X(
m
)
]
</code></pre>
  </div>


<p>Flag:</p>
<p><code>bwctf{Lmao_pow_function_is_too_powerful...Time_to_ban_it!!!!}</code></p>
<h1 id="rsajail-2---20-solves">RSAjail-2 - 20 solves<a href="#rsajail-2---20-solves" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<blockquote>
<p>Let&rsquo;s learn about RSA again!</p>
<p><code>nc rsajail2.chal.perfect.blue 1337</code></p></blockquote>
<p>The source code is almost the exact same as RSAjail-3, except this time we are restricted to max 2 characters.</p>

  <img src="./img/diff.png"  class="center"  style="border-radius: 5px; width: 100%"  />


<p>This isn&rsquo;t a problem for most of our code, as we can actually make every line 2 characters long, since none of the operators are more than 2 characters.</p>
<p>Except for the <code>pow</code> function.</p>
<p>As hinted by in the previous flag, we can no longer use <code>pow</code>, as it is longer than 3 characters.</p>
<pre tabindex="0"><code>&gt;&gt;&gt; [
... po
... w
  File &#34;&lt;stdin&gt;&#34;, line 2
    po
    ^
SyntaxError: invalid syntax. Perhaps you forgot a comma?
&gt;&gt;&gt; [
... po
... w,
  File &#34;&lt;stdin&gt;&#34;, line 2
    po
    ^
SyntaxError: invalid syntax. Perhaps you forgot a comma?
&gt;&gt;&gt;
</code></pre><p>After thinking for a while, I came to the sad conclusion that we really couldn&rsquo;t use <code>pow</code> at all.</p>
<p>Which leaves only one solution - to implement <code>pow</code> itself.</p>
<p>There are 2 main components of <code>pow</code> we need to implement:</p>
<ul>
<li>Modular inverse - to calculate <code>d</code>, <code>d = pow(e, -1, tn)</code>, or $d = e^{-1} \bmod{\varphi(N)}$</li>
<li>Modular exponentiation - to calculate <code>m</code>, <code>m = pow(c, d, N)</code>, or $m = c^d \bmod{N}$</li>
</ul>
<p>Each of these have their own algorithms which we must implement.</p>
<h3 id="modular-inverse">Modular Inverse<a href="#modular-inverse" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>The modular inverse of $e$ modular $\varphi(N)$ is $d$ such that $d \times e = 1 \bmod{\varphi(N)}$, or $d = e^{-1} \bmod{\varphi(N)}$.</p>
<p>The smallest, &ldquo;simplest&rdquo; implementation of modular inverse I could find was <a href="https://stackoverflow.com/a/57173975">this</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">invmod</span>(e, t):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> t <span style="color:#f92672">%</span> e <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> t <span style="color:#f92672">-</span> invmod(t <span style="color:#f92672">%</span> e, e) <span style="color:#f92672">*</span> t <span style="color:#f92672">//</span> e
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span></code></pre></div><p>However, this used recursion, which would be hard, if not impossible, to implement with our current constraints.</p>
<p>My thought was to find another implementation that used loops instead of recursion, and ChatGPT came up with this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">modular_inverse</span>(a, m):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extended Euclidean Algorithm</span>
</span></span><span style="display:flex;"><span>    m0, x0, x1 <span style="color:#f92672">=</span> m, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> a <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># q is the quotient</span>
</span></span><span style="display:flex;"><span>        q <span style="color:#f92672">=</span> a <span style="color:#f92672">//</span> m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Update m and a</span>
</span></span><span style="display:flex;"><span>        m, a <span style="color:#f92672">=</span> a <span style="color:#f92672">%</span> m, m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Update x0 and x1</span>
</span></span><span style="display:flex;"><span>        x0, x1 <span style="color:#f92672">=</span> x1 <span style="color:#f92672">-</span> q <span style="color:#f92672">*</span> x0, x0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Make x1 positive</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> x1 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        x1 <span style="color:#f92672">+=</span> m0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x1
</span></span></code></pre></div><p>The code seems longer and more complex, but for our purposes, its significantly better than recursing. The most tricky part is the <code>while</code> loop.</p>
<p>Currently, the method I thought of for having conditionals was by indexing a list with a boolean value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>[false_value, true_value][statement]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>e<span style="color:#f92672">.</span>g
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> a <span style="color:#f92672">==</span> b:
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>becomes
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> [a, a<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][a <span style="color:#f92672">==</span> b]
</span></span></code></pre></div><p>As if <code>a == b</code> is <code>True</code>, <code>True == 1</code>, then <code>a+1</code> is indexed in the list.</p>
<p>This comes in useful later, especially in RSAjail-1, but for now, I couldn&rsquo;t figure out how to implement the <code>while</code> loop. So I settled for an easy, but bad solution - loop a constant amount of times.</p>
<p>After doing some testing, I found that when calculating <code>modular_inverse(e, tn)</code>, the most common number of times the <code>while</code> loop looped was around 10 - around 20% of the time, the <code>while</code> loop looped 10 times.</p>
<p>Also, looping additional times doesn&rsquo;t work since <code>a</code> becomes zero and causes an error, and we get incorrect values - it has to be the <em>exact</em> amount of loops.</p>
<p>So if we just assume the number of times it should loop to be 10, we can ignore the whole <code>while</code> loop and simply repeat the code 10 times. Yes, this is a bad solution because it means our code will only work 20% of the time which means we need to run it multiple times, but hey, we only need one to succeed to get the flag.</p>
<p>For readibility purposes, from now on I will remove newlines to make the code more readible, but keep in mind that all of it can be split into 1 or 2 characters per line.</p>
<p>As such, the code for modular inverse is shown below (the params <code>N</code>, <code>p</code>, <code>c</code> used to test the code are specifically chosen to require exactly 10 iterations for modular inverse):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#75715e"># testing code (initial params)</span>
</span></span><span style="display:flex;"><span>(N, p, c) <span style="color:#f92672">=</span> (<span style="color:#ae81ff">19658816114015959168822661506934810897746960941508301523029898136829954236422356288230696714218497509145448247127171276213685927588540138953910488498609797415885703059377908419410932089341671694572542346075296204447444635775115780432725985759675826220650952905101702667277980946442594098014568732789802673665948374898957822760563388032882144793699908413806535153648788672441229731217180934020288215355778531902884992191186932322134304183424209934547418908138707378543224870398215257997452996156391765986265663605807716031637406873668707844344556614477347738848967105230266893964009548166816589883344551162998406852921</span>,    <span style="color:#ae81ff">130453368488282617461032810074522133815958556838372320878351037317254582579520496442111308634980986173256623006744002301860206808920405156266044823886359095797043398827547968038679184174328667197382367501477538816429160786329587127876859248437805001084458927041274502045315450217629728195086234876359956231457</span>,    <span style="color:#ae81ff">13744931957300834343941499214006421832495560668326408947644526682079295296305397660682804331317391989884003392518865595292355407089611107473270751078128872540223442273373149271630197488186365946706676562083273458975899416720247794630700231499328623744814876504110721712986876341468298674650169917173229382920193142678531197592139459588909453925413821274674689810706722906260374211405950154749723078233574515629772740102349908848284048531666223469582108155571783981605954997368045859488344919296326481276368474768862732504806729887028262252937842921369526516806823341787109372303286419458445259998500379305959543029395</span>,)
</span></span><span style="display:flex;"><span>X <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> m: open(<span style="color:#e6db74">&#34;./fn.py&#34;</span>, <span style="color:#e6db74">&#34;w&#34;</span>)<span style="color:#f92672">.</span>write(str(m))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># actual code</span>
</span></span><span style="display:flex;"><span>[q<span style="color:#f92672">:=</span>N<span style="color:#f92672">//</span>p,Q<span style="color:#f92672">:=</span>q<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,P<span style="color:#f92672">:=</span>p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,t<span style="color:#f92672">:=</span>Q<span style="color:#f92672">*</span>P,e<span style="color:#f92672">:=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">16</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>[a<span style="color:#f92672">:=</span>e,m<span style="color:#f92672">:=</span>t,m0<span style="color:#f92672">:=</span>m,x0<span style="color:#f92672">:=</span><span style="color:#ae81ff">0</span>,x1<span style="color:#f92672">:=</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>[q<span style="color:#f92672">:=</span>a<span style="color:#f92672">//</span>m,M<span style="color:#f92672">:=</span>m,m<span style="color:#f92672">:=</span>a<span style="color:#f92672">%</span>m,a<span style="color:#f92672">:=</span>M,X0<span style="color:#f92672">:=</span>x0,x0<span style="color:#f92672">:=</span>x1<span style="color:#f92672">-</span>q<span style="color:#f92672">*</span>x0,x1<span style="color:#f92672">:=</span>X0]
</span></span><span style="display:flex;"><span>[q<span style="color:#f92672">:=</span>a<span style="color:#f92672">//</span>m,M<span style="color:#f92672">:=</span>m,m<span style="color:#f92672">:=</span>a<span style="color:#f92672">%</span>m,a<span style="color:#f92672">:=</span>M,X0<span style="color:#f92672">:=</span>x0,x0<span style="color:#f92672">:=</span>x1<span style="color:#f92672">-</span>q<span style="color:#f92672">*</span>x0,x1<span style="color:#f92672">:=</span>X0]
</span></span><span style="display:flex;"><span>[q<span style="color:#f92672">:=</span>a<span style="color:#f92672">//</span>m,M<span style="color:#f92672">:=</span>m,m<span style="color:#f92672">:=</span>a<span style="color:#f92672">%</span>m,a<span style="color:#f92672">:=</span>M,X0<span style="color:#f92672">:=</span>x0,x0<span style="color:#f92672">:=</span>x1<span style="color:#f92672">-</span>q<span style="color:#f92672">*</span>x0,x1<span style="color:#f92672">:=</span>X0]
</span></span><span style="display:flex;"><span>[q<span style="color:#f92672">:=</span>a<span style="color:#f92672">//</span>m,M<span style="color:#f92672">:=</span>m,m<span style="color:#f92672">:=</span>a<span style="color:#f92672">%</span>m,a<span style="color:#f92672">:=</span>M,X0<span style="color:#f92672">:=</span>x0,x0<span style="color:#f92672">:=</span>x1<span style="color:#f92672">-</span>q<span style="color:#f92672">*</span>x0,x1<span style="color:#f92672">:=</span>X0]
</span></span><span style="display:flex;"><span>[q<span style="color:#f92672">:=</span>a<span style="color:#f92672">//</span>m,M<span style="color:#f92672">:=</span>m,m<span style="color:#f92672">:=</span>a<span style="color:#f92672">%</span>m,a<span style="color:#f92672">:=</span>M,X0<span style="color:#f92672">:=</span>x0,x0<span style="color:#f92672">:=</span>x1<span style="color:#f92672">-</span>q<span style="color:#f92672">*</span>x0,x1<span style="color:#f92672">:=</span>X0]
</span></span><span style="display:flex;"><span>[q<span style="color:#f92672">:=</span>a<span style="color:#f92672">//</span>m,M<span style="color:#f92672">:=</span>m,m<span style="color:#f92672">:=</span>a<span style="color:#f92672">%</span>m,a<span style="color:#f92672">:=</span>M,X0<span style="color:#f92672">:=</span>x0,x0<span style="color:#f92672">:=</span>x1<span style="color:#f92672">-</span>q<span style="color:#f92672">*</span>x0,x1<span style="color:#f92672">:=</span>X0]
</span></span><span style="display:flex;"><span>[q<span style="color:#f92672">:=</span>a<span style="color:#f92672">//</span>m,M<span style="color:#f92672">:=</span>m,m<span style="color:#f92672">:=</span>a<span style="color:#f92672">%</span>m,a<span style="color:#f92672">:=</span>M,X0<span style="color:#f92672">:=</span>x0,x0<span style="color:#f92672">:=</span>x1<span style="color:#f92672">-</span>q<span style="color:#f92672">*</span>x0,x1<span style="color:#f92672">:=</span>X0]
</span></span><span style="display:flex;"><span>[q<span style="color:#f92672">:=</span>a<span style="color:#f92672">//</span>m,M<span style="color:#f92672">:=</span>m,m<span style="color:#f92672">:=</span>a<span style="color:#f92672">%</span>m,a<span style="color:#f92672">:=</span>M,X0<span style="color:#f92672">:=</span>x0,x0<span style="color:#f92672">:=</span>x1<span style="color:#f92672">-</span>q<span style="color:#f92672">*</span>x0,x1<span style="color:#f92672">:=</span>X0]
</span></span><span style="display:flex;"><span>[q<span style="color:#f92672">:=</span>a<span style="color:#f92672">//</span>m,M<span style="color:#f92672">:=</span>m,m<span style="color:#f92672">:=</span>a<span style="color:#f92672">%</span>m,a<span style="color:#f92672">:=</span>M,X0<span style="color:#f92672">:=</span>x0,x0<span style="color:#f92672">:=</span>x1<span style="color:#f92672">-</span>q<span style="color:#f92672">*</span>x0,x1<span style="color:#f92672">:=</span>X0]
</span></span><span style="display:flex;"><span>[q<span style="color:#f92672">:=</span>a<span style="color:#f92672">//</span>m,M<span style="color:#f92672">:=</span>m,m<span style="color:#f92672">:=</span>a<span style="color:#f92672">%</span>m,a<span style="color:#f92672">:=</span>M,X0<span style="color:#f92672">:=</span>x0,x0<span style="color:#f92672">:=</span>x1<span style="color:#f92672">-</span>q<span style="color:#f92672">*</span>x0,x1<span style="color:#f92672">:=</span>X0]
</span></span><span style="display:flex;"><span>[d<span style="color:#f92672">:=</span>[x1,x1<span style="color:#f92672">+</span>m0][x1<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span>]]
</span></span><span style="display:flex;"><span><span style="color:#75715e"># testing code (to validate)</span>
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> N<span style="color:#f92672">//</span>p
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> d <span style="color:#f92672">==</span> pow(<span style="color:#ae81ff">0x10001</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, (p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>(q<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>))
</span></span></code></pre></div><h3 id="modular-exponentiation">Modular Exponentiation<a href="#modular-exponentiation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Modular exponentiation is simply calculating $m$ where $m = c^d \bmod{N}$. Since $d$ is a very large number, we can&rsquo;t just simply multiply $c$ together $d$ times - this is infeasible. But the result is done modulo $N$, which will be small.</p>
<p>There exists the <a href="https://simple.wikipedia.org/wiki/Exponentiation_by_squaring">exponentiation by squaring algorithm</a>,</p>

  <img src="./img/exp_by_squaring.png"  class="center"  style="border-radius: 5px; width: 100%"  />


<p>It is another recursive algorithm, but this time its much more simple, and we can reduce it into a while loop as well:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exp</span>(c, d, n):
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2048</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> d <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            r <span style="color:#f92672">=</span> (r <span style="color:#f92672">*</span> c) <span style="color:#f92672">%</span> n
</span></span><span style="display:flex;"><span>        c <span style="color:#f92672">=</span> (c <span style="color:#f92672">*</span> c) <span style="color:#f92672">%</span> n
</span></span><span style="display:flex;"><span>        d <span style="color:#f92672">=</span> d <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> r
</span></span></code></pre></div><p>What this does is go through each bit of $d$. If the bit is 1, it multiplies the result $r$ by $c^{2^i} \bmod{N}$ where $i$ is the position of the bit starting at 0.</p>
<p>The amount of times we need to loop is simply the bitlength of $d$, which will be less than or equal to the bitlength of $N$, which is 2048, so we will loop for a maximum of 2048 times. This time, it doesn&rsquo;t matter if we loop more than we need to, since if we do, the higher bits of $d$ will just be 0, so the result won&rsquo;t change.</p>
<p>Implementing this is pretty simple, but it just takes a lot of lines since we&rsquo;re looping 2048 times:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>[r<span style="color:#f92672">:=</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>	r<span style="color:#f92672">:=</span>[r,(r<span style="color:#f92672">*</span>c)<span style="color:#f92672">%</span>N][d<span style="color:#f92672">%</span><span style="color:#ae81ff">2</span><span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>	c<span style="color:#f92672">:=</span>(c<span style="color:#f92672">*</span>c)<span style="color:#f92672">%</span>N,d<span style="color:#f92672">:=</span>d<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>	r<span style="color:#f92672">:=</span>[r,(r<span style="color:#f92672">*</span>c)<span style="color:#f92672">%</span>N][d<span style="color:#f92672">%</span><span style="color:#ae81ff">2</span><span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>	c<span style="color:#f92672">:=</span>(c<span style="color:#f92672">*</span>c)<span style="color:#f92672">%</span>N,d<span style="color:#f92672">:=</span>d<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>	r<span style="color:#f92672">:=</span>[r,(r<span style="color:#f92672">*</span>c)<span style="color:#f92672">%</span>N][d<span style="color:#f92672">%</span><span style="color:#ae81ff">2</span><span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>	c<span style="color:#f92672">:=</span>(c<span style="color:#f92672">*</span>c)<span style="color:#f92672">%</span>N,d<span style="color:#f92672">:=</span>d<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> (repeated <span style="color:#ae81ff">2048</span> times <span style="color:#f92672">in</span> total)
</span></span><span style="display:flex;"><span>[m<span style="color:#f92672">:=</span>r]
</span></span></code></pre></div><h3 id="final-solve">Final solve<a href="#final-solve" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Now that we have modular inverse and modular exponentiation algorithms implemented, we can simply combine them to get the flag. Keep in mind we need to run this a few times on remote, since we hardcoded loop amount for modular inverse.</p>
<p>The <a href="/posts/rsajail-bwctf-2024/rsajail-2-sol.txt">final code</a> turned out to be ~70000 lines long, with ~200k characters. Believe it or not, this is nothing compared to RSAjail-1&hellip;</p>
<p>I decided to manually copy and paste it into the terminal. It lagged for a bit, but eventually processed and pasted the characters.</p>

  <img src="./img/flag-2.png"  class="center"  style="border-radius: 5px; width: 100%"  />


<p>Flag: <code>bwctf{:=_is_called_the_walrus_operator_I_assume_it_was_very_helpful}</code></p>
<h1 id="rsajail-1---8-solves">RSAjail-1 - 8 solves<a href="#rsajail-1---8-solves" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Time for the final challenge. You guessed it, exact same source as previous times, except we are only allowed ONE character per line.</p>
<p>This means we can no longer use operators that aren&rsquo;t 1 character long.</p>
<p>We now have 2 very big problems to tackle:</p>
<ul>
<li>We can no longer store variables, since the walrus operator <code>:=</code> is 2 characters long</li>
<li>We can no longer perform integer division, since <code>//</code> is 2 characters long</li>
</ul>
<h3 id="singular-variable">Singular variable<a href="#singular-variable" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>With no walrus operator, there seems to no way to store values across multiple expressions. Without being able to store values, solving the challenge is impossible.</p>
<p>But actually, there is still a variable we can use and modify. In the Python interpreter, <code>_</code> is a special variable which stores the result of the last expression:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> _
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> _ <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>We can abuse this by setting <code>_</code> to a dictionary, and indexing <code>_</code> to retrieve previous values.</p>
<p>For example, we can calculate <code>(p-1)*(q-1)</code> like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> {
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> :
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> p
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> ,
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> :
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> q
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> }
</span></span><span style="display:flex;"><span>{<span style="color:#ae81ff">1</span>: <span style="color:#ae81ff">130453368488282617461032810074522133815958556838372320878351037317254582579520496442111308634980986173256623006744002301860206808920405156266044823886359095797043398827547968038679184174328667197382367501477538816429160786329587127876859248437805001084458927041274502045315450217629728195086234876359956231456</span>, <span style="color:#ae81ff">2</span>: <span style="color:#ae81ff">150696117254969335819306125948039770222551358810181509713201480554139338362396967781188614953302019959221233518074437714525269530003480482301144411821795677909740495479721830825842680697306040107729861936962506057445590196810051637125467630512958374263647444393642284997681698662489843408404877087566659920152</span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> {
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> :
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> _
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> [
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> ]
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> _
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> [
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> ]
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> }
</span></span><span style="display:flex;"><span>{<span style="color:#ae81ff">3</span>: <span style="color:#ae81ff">19658816114015959168822661506934810897746960941508301523029898136829954236422356288230696714218497509145448247127171276213685927588540138953910488498609797415885703059377908419410932089341671694572542346075296204447444635775115780432725985759675826220650952905101702667277980946442594098014568732789802673665667225413214570807283049096859582889661398498157981323057236154569835810275263469796988291767495525770407135666368492305748827844500324295980229672430552604836440976090945459132931131284757058681153434167367671157762655890529069079342229735526584363500860733795350106921012399286697018279853439199071790701312</span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>In the example above, we used dictionary key <code>1</code> to store <code>p-1</code> and key <code>2</code> to store <code>q-1</code>. Then we calculated <code>(p-1)*(q-1)</code> through <code>_[1]*_[2]</code>, storing it in key <code>3</code>. (Yes, I could&rsquo;ve used <code>()</code> brackets to do it in one go, but I wanted to illustrate an example of persisting values across expressions)</p>
<p>If we want certain values to persist, we can simply assign the key to its previous self, such as <code>{1:_[1]}</code>. Doing this, we can now keep track of values across multiple expressions.</p>
<p>From now on, I will condense all expressions into a single line, without newlines, for readibily. But keep in mind that every character will be on its own line, thus operators and values 2 chars or longer can&rsquo;t be used.</p>
<h3 id="integer-division---calculating-q--n--p">Integer division - calculating <code>q = N // p</code><a href="#integer-division---calculating-q--n--p" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Okay, so <code>//</code> is banned, so we can&rsquo;t divide two integers. Which is tragic, as some parts of our solution from RSAjail-2 requires integer division. Including the simplest one, <code>q = N // p</code>.</p>
<p>But how hard is it to divide numbers without <code>//</code>?</p>
<p>We could use <code>/</code>, which would output a float, but for our purpose, dividing two large integers results in a lot of precision lost, and there is also no way to convert it back into an integer.</p>
<p>Which leaves us with only one choice - to <strong>implement integer division manually</strong>.</p>
<p>This turned out to be extremely tricky - we need something that doesn&rsquo;t have too many conditions/loops, since those are hard to implement, and also no bitshifts, as <code>&gt;&gt;</code> and <code>&lt;&lt;</code> are too long.</p>
<p>I asked ChatGPT until it gave me something I was looking for, and modified it to become this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">divide</span>(dividend, divisor):
</span></span><span style="display:flex;"><span>    quotient <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    multiples <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Precompute multiples of the divisor to avoid the inner loop</span>
</span></span><span style="display:flex;"><span>    current_multiple <span style="color:#f92672">=</span> divisor
</span></span><span style="display:flex;"><span>    current_quotient <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    times <span style="color:#f92672">=</span> divisor<span style="color:#f92672">.</span>bit_length()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(times):
</span></span><span style="display:flex;"><span>        multiples<span style="color:#f92672">.</span>append((current_multiple, current_quotient))
</span></span><span style="display:flex;"><span>        current_multiple <span style="color:#f92672">+=</span> current_multiple  <span style="color:#75715e"># Double it</span>
</span></span><span style="display:flex;"><span>        current_quotient <span style="color:#f92672">+=</span> current_quotient  <span style="color:#75715e"># Double the corresponding quotient</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Now, subtract the largest possible multiples</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(times):
</span></span><span style="display:flex;"><span>        multiple, multiple_quotient <span style="color:#f92672">=</span> multiples[times <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> i]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> dividend <span style="color:#f92672">&gt;=</span> multiple:
</span></span><span style="display:flex;"><span>            dividend <span style="color:#f92672">-=</span> multiple  <span style="color:#75715e"># 3</span>
</span></span><span style="display:flex;"><span>            quotient <span style="color:#f92672">+=</span> multiple_quotient  <span style="color:#75715e"># 9</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> quotient
</span></span></code></pre></div><p>It&rsquo;s kinda confusing how it divides, but it does work. The main things to note is that the times we iterate depends on the size of the divisor, which in the case of <code>q = N // p</code>, <code>p</code> has bitlength 1024 so we will loop that many times. It also doesn&rsquo;t matter if we loop too many times, which is good, so I settled with 1028 times just in case.</p>
<p>Notice the <code>multiples</code> list is just $\text{divisor} * 2^i$ (<code>current_multiple</code>) and powers of 2, $2^i$ (<code>current_quotient</code>), for $i$ being from 0 to the bitlength of the divisor.</p>
<p>Since we know the powers of 2, we can pre-compute them, so instead of having a list of tuples, we can just have a list of multiples of the divisor ($\text{divisor} * 2^i$).</p>
<p>And we do have a way to append elements onto lists, using <code>[a] + [b] = [a, b]</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> {<span style="color:#ae81ff">1</span>:[]}
</span></span><span style="display:flex;"><span>{<span style="color:#ae81ff">1</span>: []}
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> {<span style="color:#ae81ff">1</span>:_[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">+</span>[<span style="color:#ae81ff">2</span>]}
</span></span><span style="display:flex;"><span>{<span style="color:#ae81ff">1</span>: [<span style="color:#ae81ff">2</span>]}
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> {<span style="color:#ae81ff">1</span>:_[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">+</span>[<span style="color:#ae81ff">3</span>]}
</span></span><span style="display:flex;"><span>{<span style="color:#ae81ff">1</span>: [<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]}
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>You may be wondering why we can&rsquo;t compute the multiples of the divisor during the second loop, eliminating the need for a list. This is because in the second loop, we loop backwards through the multiples, going from e.g. $\text{divisor} * 2^{1027}$, $\text{divisor} * 2^{1026}$ &hellip; $\text{divisor} * 2^0$. And to go from $\text{divisor} * 2^{1027}$ to $\text{divisor} * 2^{1026}$, we need integer division, dividing by 2 (<code>// 2</code>) - the thing we are literally trying to implement. So it makes more sense to start from $\text{divisor}$, and keep doubling it, 1028 times.</p>
<p>Our first step is to generate the list of divisor multiples, $\text{divisor} * 2^i$:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>{<span style="color:#ae81ff">8</span>:[],<span style="color:#ae81ff">7</span>:p}
</span></span><span style="display:flex;"><span>{<span style="color:#ae81ff">8</span>:_[<span style="color:#ae81ff">8</span>]<span style="color:#f92672">+</span>[_[<span style="color:#ae81ff">7</span>]],<span style="color:#ae81ff">7</span>:_[<span style="color:#ae81ff">7</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>}
</span></span><span style="display:flex;"><span>{<span style="color:#ae81ff">8</span>:_[<span style="color:#ae81ff">8</span>]<span style="color:#f92672">+</span>[_[<span style="color:#ae81ff">7</span>]],<span style="color:#ae81ff">7</span>:_[<span style="color:#ae81ff">7</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>}
</span></span><span style="display:flex;"><span>{<span style="color:#ae81ff">8</span>:_[<span style="color:#ae81ff">8</span>]<span style="color:#f92672">+</span>[_[<span style="color:#ae81ff">7</span>]],<span style="color:#ae81ff">7</span>:_[<span style="color:#ae81ff">7</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> (repeated <span style="color:#ae81ff">1028</span> times)
</span></span></code></pre></div><p>Then, we do the second loop.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;multiples&#34;</span>:_[<span style="color:#ae81ff">8</span>],<span style="color:#e6db74">&#34;current_multiple&#34;</span>:_[<span style="color:#ae81ff">7</span>],<span style="color:#e6db74">&#34;current_quotient&#34;</span>:<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#34;dividend&#34;</span>:N,<span style="color:#e6db74">&#34;quotient&#34;</span>:<span style="color:#ae81ff">0</span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e"># iteration 0</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;multiples&#34;</span>: _[<span style="color:#e6db74">&#34;multiples&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;dividend&#34;</span>: _[<span style="color:#e6db74">&#34;dividend&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;quotient&#34;</span>: _[<span style="color:#e6db74">&#34;quotient&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>: <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">1027</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;multiples&#34;</span>: _[<span style="color:#e6db74">&#34;multiples&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;dividend&#34;</span>: _[<span style="color:#e6db74">&#34;dividend&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;quotient&#34;</span>: _[<span style="color:#e6db74">&#34;quotient&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;multiple&#34;</span>: _[<span style="color:#e6db74">&#34;multiples&#34;</span>][<span style="color:#ae81ff">1027</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>: _[<span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;multiples&#34;</span>: _[<span style="color:#e6db74">&#34;multiples&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;dividend&#34;</span>: [_[<span style="color:#e6db74">&#34;dividend&#34;</span>] <span style="color:#f92672">-</span> _[<span style="color:#e6db74">&#34;multiple&#34;</span>], _[<span style="color:#e6db74">&#34;dividend&#34;</span>]][
</span></span><span style="display:flex;"><span>        _[<span style="color:#e6db74">&#34;dividend&#34;</span>] <span style="color:#f92672">&lt;</span> _[<span style="color:#e6db74">&#34;multiple&#34;</span>]
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;quotient&#34;</span>: [_[<span style="color:#e6db74">&#34;quotient&#34;</span>] <span style="color:#f92672">+</span> _[<span style="color:#ae81ff">2</span>], _[<span style="color:#e6db74">&#34;quotient&#34;</span>]][_[<span style="color:#e6db74">&#34;dividend&#34;</span>] <span style="color:#f92672">&lt;</span> _[<span style="color:#e6db74">&#34;multiple&#34;</span>]],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;multiple&#34;</span>: _[<span style="color:#e6db74">&#34;multiple&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>: _[<span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e"># iteration 1</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;multiples&#34;</span>: _[<span style="color:#e6db74">&#34;multiples&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;dividend&#34;</span>: _[<span style="color:#e6db74">&#34;dividend&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;quotient&#34;</span>: _[<span style="color:#e6db74">&#34;quotient&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>: <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">1026</span>, <span style="color:#75715e"># note how this changed</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;multiples&#34;</span>: _[<span style="color:#e6db74">&#34;multiples&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;dividend&#34;</span>: _[<span style="color:#e6db74">&#34;dividend&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;quotient&#34;</span>: _[<span style="color:#e6db74">&#34;quotient&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;multiple&#34;</span>: _[<span style="color:#e6db74">&#34;multiples&#34;</span>][<span style="color:#ae81ff">1026</span>], <span style="color:#75715e"># note how this changed</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>: _[<span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;multiples&#34;</span>: _[<span style="color:#e6db74">&#34;multiples&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;dividend&#34;</span>: [_[<span style="color:#e6db74">&#34;dividend&#34;</span>] <span style="color:#f92672">-</span> _[<span style="color:#e6db74">&#34;multiple&#34;</span>], _[<span style="color:#e6db74">&#34;dividend&#34;</span>]][
</span></span><span style="display:flex;"><span>        _[<span style="color:#e6db74">&#34;dividend&#34;</span>] <span style="color:#f92672">&lt;</span> _[<span style="color:#e6db74">&#34;multiple&#34;</span>]
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;quotient&#34;</span>: [_[<span style="color:#e6db74">&#34;quotient&#34;</span>] <span style="color:#f92672">+</span> _[<span style="color:#ae81ff">2</span>], _[<span style="color:#e6db74">&#34;quotient&#34;</span>]][_[<span style="color:#e6db74">&#34;dividend&#34;</span>] <span style="color:#f92672">&lt;</span> _[<span style="color:#e6db74">&#34;multiple&#34;</span>]],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;multiple&#34;</span>: _[<span style="color:#e6db74">&#34;multiple&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>: _[<span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> (repeated <span style="color:#ae81ff">1027</span> times <span style="color:#66d9ef">with</span> modifications)
</span></span></code></pre></div><p>There are many things to note here:</p>
<ul>
<li>The dictionary keys are now strings. This is purely for readibility - in the final code, they will be replaced with unique numbers as keys, since obviously we can&rsquo;t have strings as a quote is already 1 character, so keys must be integers.</li>
<li>There are numbers which are longer than 1 digit, which can&rsquo;t happen. However, in the final code, this is replaced with expressions that evaluate to that number. For example, <code>2**1027</code> has <code>**</code> as the operator, which is 2 characters so can&rsquo;t actually be used. However, we can simply express it as <code>2*2*2... (repeated 1027 times total)</code>. Similarly with <code>1027</code>, we can write <code>1027 = 8*8*8*2+3</code>, and <code>1026 = 8*8*8*2+3 - 1</code> etc.</li>
<li>We are again using the list indexing trick for the conditionals, but we are checking for <code>dividend &lt; multiple</code> instead of <code>dividend &gt;= multiple</code> like in the original code. This is because <code>&gt;=</code> is 2 characters long, so we must use the one character operator <code>&lt;</code> instead, and swap the list elements.</li>
</ul>
<p>Yes, there are a lot of redundant parts that could be easily golfed, but I didn&rsquo;t really care about the size at that time.</p>
<p>To repeat those 3 lines 1028 times, I used a script to format it:</p>

  <img src="./img/fmt-script-1.png"  class="center"  style="border-radius: 5px; width: 100%"  />


<p>And thats how you turn one line of code, <code>q=N//p</code>, into <a href="/posts/rsajail-bwctf-2024/f1_fmtted_.txt">almost 800k lines</a>.</p>
<p>That&rsquo;s not the end either - there&rsquo;s still other places that use integer division, such as modular inverse.</p>
<h3 id="integer-division---in-modular-inverse-algorithm">Integer division - in modular inverse algorithm<a href="#integer-division---in-modular-inverse-algorithm" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Recall our modular inverse algorithm was based off this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">modular_inverse</span>(a, m):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extended Euclidean Algorithm</span>
</span></span><span style="display:flex;"><span>    m0, x0, x1 <span style="color:#f92672">=</span> m, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> a <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># q is the quotient</span>
</span></span><span style="display:flex;"><span>        q <span style="color:#f92672">=</span> a <span style="color:#f92672">//</span> m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Update m and a</span>
</span></span><span style="display:flex;"><span>        m, a <span style="color:#f92672">=</span> a <span style="color:#f92672">%</span> m, m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Update x0 and x1</span>
</span></span><span style="display:flex;"><span>        x0, x1 <span style="color:#f92672">=</span> x1 <span style="color:#f92672">-</span> q <span style="color:#f92672">*</span> x0, x0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Make x1 positive</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> x1 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        x1 <span style="color:#f92672">+=</span> m0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x1
</span></span></code></pre></div><p><code>q = a // m</code>. Yeah that&rsquo;s right, we&rsquo;re doing this all again. Multiple times.</p>
<p>But I&rsquo;ll spare you the pain of all the debugging and formatting I had to do. The main things were that we hardcoded the modular inverse loop to run ~10 times, so we had to repeat ALL that manual division code above, 10 times. But I thought, since the numbers are smaller, they should have smaller bit lengths so we don&rsquo;t need that many lines. Upon some testing, the first division turned out to require 2048 loops, and the rest were all &lt;20 loops, so it wasn&rsquo;t all that bad.</p>
<p>It was a pain to debug, though. With so much code and so much room for error, I had to debug so many times. And with how large the code is, even with helper scripts, it took almost 2 minutes to run each time. It took an incredible amount of time to finally get it working.</p>
<p>Also, another difference between the previous <code>q = N//p</code> division is that we also had to keep track of <code>m0</code>, <code>x0</code>, <code>x1</code>, and <code>a</code> values, but this isn&rsquo;t hard since you can just do something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;a&#34;</span>:_[<span style="color:#e6db74">&#34;a&#34;</span>],<span style="color:#e6db74">&#34;m&#34;</span>:_[<span style="color:#e6db74">&#34;m&#34;</span>],<span style="color:#e6db74">&#34;m0&#34;</span>:_[<span style="color:#e6db74">&#34;m0&#34;</span>],<span style="color:#e6db74">&#34;x0&#34;</span>:_[<span style="color:#e6db74">&#34;x0&#34;</span>],<span style="color:#e6db74">&#34;x1&#34;</span>:_[<span style="color:#e6db74">&#34;x1&#34;</span>],<span style="color:#e6db74">&#34;multiples&#34;</span>:_[<span style="color:#e6db74">&#34;multiples&#34;</span>],<span style="color:#e6db74">&#34;dividend&#34;</span>:[_[<span style="color:#e6db74">&#34;dividend&#34;</span>]<span style="color:#f92672">-</span>_[<span style="color:#e6db74">&#34;multiple&#34;</span>],_[<span style="color:#e6db74">&#34;dividend&#34;</span>]][_[<span style="color:#e6db74">&#34;dividend&#34;</span>]<span style="color:#f92672">&lt;</span>_[<span style="color:#e6db74">&#34;multiple&#34;</span>]],<span style="color:#e6db74">&#34;quotient&#34;</span>:[_[<span style="color:#e6db74">&#34;quotient&#34;</span>]<span style="color:#f92672">+</span>_[<span style="color:#ae81ff">2</span>],_[<span style="color:#e6db74">&#34;quotient&#34;</span>]][_[<span style="color:#e6db74">&#34;dividend&#34;</span>]<span style="color:#f92672">&lt;</span>_[<span style="color:#e6db74">&#34;multiple&#34;</span>]],<span style="color:#ae81ff">2</span>:_[<span style="color:#ae81ff">2</span>], <span style="color:#e6db74">&#34;multiple&#34;</span>:_[<span style="color:#e6db74">&#34;multiple&#34;</span>]}{<span style="color:#e6db74">&#34;a&#34;</span>:_[<span style="color:#e6db74">&#34;a&#34;</span>],<span style="color:#e6db74">&#34;m&#34;</span>:_[<span style="color:#e6db74">&#34;m&#34;</span>],<span style="color:#e6db74">&#34;m0&#34;</span>:_[<span style="color:#e6db74">&#34;m0&#34;</span>],<span style="color:#e6db74">&#34;x0&#34;</span>:_[<span style="color:#e6db74">&#34;x0&#34;</span>],<span style="color:#e6db74">&#34;x1&#34;</span>:_[<span style="color:#e6db74">&#34;x1&#34;</span>],<span style="color:#e6db74">&#34;multiples&#34;</span>:_[<span style="color:#e6db74">&#34;multiples&#34;</span>],<span style="color:#e6db74">&#34;dividend&#34;</span>:_[<span style="color:#e6db74">&#34;dividend&#34;</span>],<span style="color:#e6db74">&#34;quotient&#34;</span>:_[<span style="color:#e6db74">&#34;quotient&#34;</span>],<span style="color:#ae81ff">2</span>:<span style="color:#ae81ff">1</span>}
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;a&#34;</span>:_[<span style="color:#e6db74">&#34;a&#34;</span>],<span style="color:#e6db74">&#34;m&#34;</span>:_[<span style="color:#e6db74">&#34;m&#34;</span>],<span style="color:#e6db74">&#34;m0&#34;</span>:_[<span style="color:#e6db74">&#34;m0&#34;</span>],<span style="color:#e6db74">&#34;x0&#34;</span>:_[<span style="color:#e6db74">&#34;x0&#34;</span>],<span style="color:#e6db74">&#34;x1&#34;</span>:_[<span style="color:#e6db74">&#34;x1&#34;</span>],<span style="color:#e6db74">&#34;multiples&#34;</span>:_[<span style="color:#e6db74">&#34;multiples&#34;</span>],<span style="color:#e6db74">&#34;dividend&#34;</span>:_[<span style="color:#e6db74">&#34;dividend&#34;</span>],<span style="color:#e6db74">&#34;quotient&#34;</span>:_[<span style="color:#e6db74">&#34;quotient&#34;</span>],<span style="color:#ae81ff">2</span>:_[<span style="color:#ae81ff">2</span>], <span style="color:#e6db74">&#34;multiple&#34;</span>:_[<span style="color:#e6db74">&#34;multiples&#34;</span>][<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span><span style="color:#ae81ff">4</span><span style="color:#f92672">+</span><span style="color:#ae81ff">4</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]}
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;a&#34;</span>:_[<span style="color:#e6db74">&#34;a&#34;</span>],<span style="color:#e6db74">&#34;m&#34;</span>:_[<span style="color:#e6db74">&#34;m&#34;</span>],<span style="color:#e6db74">&#34;m0&#34;</span>:_[<span style="color:#e6db74">&#34;m0&#34;</span>],<span style="color:#e6db74">&#34;x0&#34;</span>:_[<span style="color:#e6db74">&#34;x0&#34;</span>],<span style="color:#e6db74">&#34;x1&#34;</span>:_[<span style="color:#e6db74">&#34;x1&#34;</span>],<span style="color:#e6db74">&#34;multiples&#34;</span>:_[<span style="color:#e6db74">&#34;multiples&#34;</span>],<span style="color:#e6db74">&#34;dividend&#34;</span>:[_[<span style="color:#e6db74">&#34;dividend&#34;</span>]<span style="color:#f92672">-</span>_[<span style="color:#e6db74">&#34;multiple&#34;</span>],_[<span style="color:#e6db74">&#34;dividend&#34;</span>]][_[<span style="color:#e6db74">&#34;dividend&#34;</span>]<span style="color:#f92672">&lt;</span>_[<span style="color:#e6db74">&#34;multiple&#34;</span>]],<span style="color:#e6db74">&#34;quotient&#34;</span>:[_[<span style="color:#e6db74">&#34;quotient&#34;</span>]<span style="color:#f92672">+</span>_[<span style="color:#ae81ff">2</span>],_[<span style="color:#e6db74">&#34;quotient&#34;</span>]][_[<span style="color:#e6db74">&#34;dividend&#34;</span>]<span style="color:#f92672">&lt;</span>_[<span style="color:#e6db74">&#34;multiple&#34;</span>]],<span style="color:#ae81ff">2</span>:_[<span style="color:#ae81ff">2</span>], <span style="color:#e6db74">&#34;multiple&#34;</span>:_[<span style="color:#e6db74">&#34;multiple&#34;</span>]}
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;a&#34;</span>:_[<span style="color:#e6db74">&#34;a&#34;</span>],<span style="color:#e6db74">&#34;m&#34;</span>:_[<span style="color:#e6db74">&#34;m&#34;</span>],<span style="color:#e6db74">&#34;m0&#34;</span>:_[<span style="color:#e6db74">&#34;m0&#34;</span>],<span style="color:#e6db74">&#34;x0&#34;</span>:_[<span style="color:#e6db74">&#34;x0&#34;</span>],<span style="color:#e6db74">&#34;x1&#34;</span>:_[<span style="color:#e6db74">&#34;x1&#34;</span>],<span style="color:#e6db74">&#34;q&#34;</span>:_[<span style="color:#e6db74">&#34;quotient&#34;</span>]}
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;a&#34;</span>:_[<span style="color:#e6db74">&#34;m&#34;</span>],<span style="color:#e6db74">&#34;m&#34;</span>:_[<span style="color:#e6db74">&#34;a&#34;</span>]<span style="color:#f92672">%</span>_[<span style="color:#e6db74">&#34;m&#34;</span>],<span style="color:#e6db74">&#34;m0&#34;</span>:_[<span style="color:#e6db74">&#34;m0&#34;</span>],<span style="color:#e6db74">&#34;x0&#34;</span>:_[<span style="color:#e6db74">&#34;x0&#34;</span>],<span style="color:#e6db74">&#34;x1&#34;</span>:_[<span style="color:#e6db74">&#34;x1&#34;</span>],<span style="color:#e6db74">&#34;q&#34;</span>:_[<span style="color:#e6db74">&#34;q&#34;</span>]}
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;a&#34;</span>:_[<span style="color:#e6db74">&#34;a&#34;</span>],<span style="color:#e6db74">&#34;m&#34;</span>:_[<span style="color:#e6db74">&#34;m&#34;</span>],<span style="color:#e6db74">&#34;m0&#34;</span>:_[<span style="color:#e6db74">&#34;m0&#34;</span>],<span style="color:#e6db74">&#34;x0&#34;</span>:_[<span style="color:#e6db74">&#34;x1&#34;</span>]<span style="color:#f92672">-</span>_[<span style="color:#e6db74">&#34;x0&#34;</span>]<span style="color:#f92672">*</span>_[<span style="color:#e6db74">&#34;q&#34;</span>],<span style="color:#e6db74">&#34;x1&#34;</span>:_[<span style="color:#e6db74">&#34;x0&#34;</span>],<span style="color:#e6db74">&#34;q&#34;</span>:_[<span style="color:#e6db74">&#34;q&#34;</span>]}
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;a&#34;</span>:_[<span style="color:#e6db74">&#34;a&#34;</span>],<span style="color:#e6db74">&#34;m&#34;</span>:_[<span style="color:#e6db74">&#34;m&#34;</span>],<span style="color:#e6db74">&#34;m0&#34;</span>:_[<span style="color:#e6db74">&#34;m0&#34;</span>],<span style="color:#e6db74">&#34;x0&#34;</span>:_[<span style="color:#e6db74">&#34;x0&#34;</span>],<span style="color:#e6db74">&#34;x1&#34;</span>:_[<span style="color:#e6db74">&#34;x1&#34;</span>]}
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;a&#34;</span>:_[<span style="color:#e6db74">&#34;a&#34;</span>],<span style="color:#e6db74">&#34;m&#34;</span>:_[<span style="color:#e6db74">&#34;m&#34;</span>],<span style="color:#e6db74">&#34;m0&#34;</span>:_[<span style="color:#e6db74">&#34;m0&#34;</span>],<span style="color:#e6db74">&#34;x0&#34;</span>:_[<span style="color:#e6db74">&#34;x0&#34;</span>],<span style="color:#e6db74">&#34;x1&#34;</span>:_[<span style="color:#e6db74">&#34;x1&#34;</span>],<span style="color:#e6db74">&#34;multiples&#34;</span>:[],<span style="color:#e6db74">&#34;current_multiple&#34;</span>:_[<span style="color:#e6db74">&#34;m&#34;</span>]}
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;a&#34;</span>:_[<span style="color:#e6db74">&#34;a&#34;</span>],<span style="color:#e6db74">&#34;m&#34;</span>:_[<span style="color:#e6db74">&#34;m&#34;</span>],<span style="color:#e6db74">&#34;m0&#34;</span>:_[<span style="color:#e6db74">&#34;m0&#34;</span>],<span style="color:#e6db74">&#34;x0&#34;</span>:_[<span style="color:#e6db74">&#34;x0&#34;</span>],<span style="color:#e6db74">&#34;x1&#34;</span>:_[<span style="color:#e6db74">&#34;x1&#34;</span>],<span style="color:#e6db74">&#34;multiples&#34;</span>:_[<span style="color:#e6db74">&#34;multiples&#34;</span>]<span style="color:#f92672">+</span>[_[<span style="color:#e6db74">&#34;current_multiple&#34;</span>]],<span style="color:#e6db74">&#34;current_multiple&#34;</span>:_[<span style="color:#e6db74">&#34;current_multiple&#34;</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>}
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;a&#34;</span>:_[<span style="color:#e6db74">&#34;a&#34;</span>],<span style="color:#e6db74">&#34;m&#34;</span>:_[<span style="color:#e6db74">&#34;m&#34;</span>],<span style="color:#e6db74">&#34;m0&#34;</span>:_[<span style="color:#e6db74">&#34;m0&#34;</span>],<span style="color:#e6db74">&#34;x0&#34;</span>:_[<span style="color:#e6db74">&#34;x0&#34;</span>],<span style="color:#e6db74">&#34;x1&#34;</span>:_[<span style="color:#e6db74">&#34;x1&#34;</span>],<span style="color:#e6db74">&#34;multiples&#34;</span>:_[<span style="color:#e6db74">&#34;multiples&#34;</span>]<span style="color:#f92672">+</span>[_[<span style="color:#e6db74">&#34;current_multiple&#34;</span>]],<span style="color:#e6db74">&#34;current_multiple&#34;</span>:_[<span style="color:#e6db74">&#34;current_multiple&#34;</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>}
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;a&#34;</span>:_[<span style="color:#e6db74">&#34;a&#34;</span>],<span style="color:#e6db74">&#34;m&#34;</span>:_[<span style="color:#e6db74">&#34;m&#34;</span>],<span style="color:#e6db74">&#34;m0&#34;</span>:_[<span style="color:#e6db74">&#34;m0&#34;</span>],<span style="color:#e6db74">&#34;x0&#34;</span>:_[<span style="color:#e6db74">&#34;x0&#34;</span>],<span style="color:#e6db74">&#34;x1&#34;</span>:_[<span style="color:#e6db74">&#34;x1&#34;</span>],<span style="color:#e6db74">&#34;multiples&#34;</span>:_[<span style="color:#e6db74">&#34;multiples&#34;</span>]<span style="color:#f92672">+</span>[_[<span style="color:#e6db74">&#34;current_multiple&#34;</span>]],<span style="color:#e6db74">&#34;current_multiple&#34;</span>:_[<span style="color:#e6db74">&#34;current_multiple&#34;</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span></code></pre></div><p>which just preserves the value by assigning it to itself, such as <code>{&quot;a&quot;:_[&quot;a&quot;], ...}</code>.</p>
<p>It just made the code considerably longer, but it&rsquo;s nothing new.</p>
<p>With that tedious section out the way, we move onto yet another instance where we need to use integer division&hellip; or not?</p>
<h3 id="integer-division-in-modular-exponentiation-or-not">Integer division in modular exponentiation&hellip; or not?<a href="#integer-division-in-modular-exponentiation-or-not" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Now that we have <code>d</code> from the previous step, our last step is to implement modular exponentiation once again, to calculate <code>m = pow(c, d, n)</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exp</span>(c, d, n):
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2048</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> d <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            r <span style="color:#f92672">=</span> (r <span style="color:#f92672">*</span> c) <span style="color:#f92672">%</span> n
</span></span><span style="display:flex;"><span>        c <span style="color:#f92672">=</span> (c <span style="color:#f92672">*</span> c) <span style="color:#f92672">%</span> n
</span></span><span style="display:flex;"><span>        d <span style="color:#f92672">=</span> d <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> r
</span></span></code></pre></div><p>There is integer division as <code>d = d // 2</code>, but notice that only the LSB of <code>d</code> is being checked. The function just loops through all bits of <code>d</code>, modifying <code>r</code> depending on if it&rsquo;s equal to 1 or not, and dividing by 2 is just another of bitshifting right by 1.</p>
<p>We can&rsquo;t use bitshifts, but we can use powers of 2. This means we can actually rewrite the code to this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exp</span>(c, d, n):
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    e <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2048</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> d <span style="color:#f92672">&amp;</span> e <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            r <span style="color:#f92672">=</span> (r <span style="color:#f92672">*</span> c) <span style="color:#f92672">%</span> n
</span></span><span style="display:flex;"><span>        c <span style="color:#f92672">=</span> (c <span style="color:#f92672">*</span> c) <span style="color:#f92672">%</span> n
</span></span><span style="display:flex;"><span>        e <span style="color:#f92672">*=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> r
</span></span></code></pre></div><p>where we use <code>e</code> as a power of 2, and use <code>&amp;</code> to see if the bit at that index is set.</p>
<p>This is great, as it means we don&rsquo;t need integer division, and it&rsquo;s pretty simple to implement!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;d&#34;</span>:_[<span style="color:#e6db74">&#34;d&#34;</span>],<span style="color:#e6db74">&#34;e&#34;</span>:<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#34;r&#34;</span>:<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#34;c&#34;</span>:c}
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;d&#34;</span>:_[<span style="color:#e6db74">&#34;d&#34;</span>],<span style="color:#e6db74">&#34;e&#34;</span>:_[<span style="color:#e6db74">&#34;e&#34;</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#34;r&#34;</span>:[_[<span style="color:#e6db74">&#34;r&#34;</span>],_[<span style="color:#e6db74">&#34;r&#34;</span>]<span style="color:#f92672">*</span>_[<span style="color:#e6db74">&#34;c&#34;</span>]<span style="color:#f92672">%</span>N][_[<span style="color:#e6db74">&#34;d&#34;</span>]<span style="color:#f92672">&amp;</span>_[<span style="color:#e6db74">&#34;e&#34;</span>]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span>],<span style="color:#e6db74">&#34;c&#34;</span>:_[<span style="color:#e6db74">&#34;c&#34;</span>]<span style="color:#f92672">*</span>_[<span style="color:#e6db74">&#34;c&#34;</span>]<span style="color:#f92672">%</span>N}
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;d&#34;</span>:_[<span style="color:#e6db74">&#34;d&#34;</span>],<span style="color:#e6db74">&#34;e&#34;</span>:_[<span style="color:#e6db74">&#34;e&#34;</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#34;r&#34;</span>:[_[<span style="color:#e6db74">&#34;r&#34;</span>],_[<span style="color:#e6db74">&#34;r&#34;</span>]<span style="color:#f92672">*</span>_[<span style="color:#e6db74">&#34;c&#34;</span>]<span style="color:#f92672">%</span>N][_[<span style="color:#e6db74">&#34;d&#34;</span>]<span style="color:#f92672">&amp;</span>_[<span style="color:#e6db74">&#34;e&#34;</span>]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span>],<span style="color:#e6db74">&#34;c&#34;</span>:_[<span style="color:#e6db74">&#34;c&#34;</span>]<span style="color:#f92672">*</span>_[<span style="color:#e6db74">&#34;c&#34;</span>]<span style="color:#f92672">%</span>N}
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span> (repeated <span style="color:#ae81ff">2048</span> times total)
</span></span><span style="display:flex;"><span>{X(_[<span style="color:#e6db74">&#34;r&#34;</span>])}
</span></span></code></pre></div><p>And at the end, we put <code>{X(_[&quot;r&quot;])}</code> to output the decrypted ciphertext (stored as <code>r</code>). Remember that all of this code is to be entered one character per line, so <code>X(_[&quot;r&quot;])</code> had to be surrounded in the curly braces <code>{}</code>, otherwise it wouldn&rsquo;t work - this messed me up before :&lt;</p>
<h3 id="final-solve-1">Final solve<a href="#final-solve-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Finally, with all the steps done, we can now start gambling for the flag! Remember how theres like a ~20% chance of getting the flag each time, and how the code takes 2 minutes to run each time.</p>
<p>But first, how do we actually send the solution code, which after optimisations (such as replacing <code>2*2</code> with <code>4</code>, etc.), replacing dictionary key names, and having 1 character per line, turned out to be almost 4 million lines long.</p>

  <img src="./img/bruh.png"  class="center"  style="border-radius: 5px; width: 100%"  />


<p>At first I tried using <a href="https://docs.pwntools.com/en/stable/">pwntools</a>, but it kept freezing/EOF erroring for some reason, even when I split up chunks of it or tried sending it one line at a time. Maybe it&rsquo;s just a skill issue.</p>
<p>Next, I tried connecting manually, and pasting it directly into the terminal. For Windows Terminal, this caused it to crash, but somehow it worked on <a href="https://en.wikipedia.org/wiki/Windows_Subsystem_for_Linux">WSL</a>. It took 5 minutes to load, not to mention there is a PoW to solve each time. So I opened multiple terminals, and prayed.</p>
<p>Eventually, we got the flag.</p>

  <img src="./img/les-goooo.png"  class="center"  style="border-radius: 5px; width: 100%"  />


<p><code>bwctf{Did_you_have_fun_with_only_one_variable?_Good_thing_*tuple*_exists_UwU}</code></p>
<p>You can view the final formatted code <a href="/posts/rsajail-bwctf-2024/final_fmtted.txt">here</a>, but I suggest reading the <a href="/posts/rsajail-bwctf-2024/f4_final.txt">unformatted version</a>. Actually, both of them are practically unreadible, but there you go I guess.</p>
<h1 id="conclusion">Conclusion<a href="#conclusion" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>This was a really nice set of challenges, combining both RSA (crypto?) and Pyjail.</p>
<p>Thanks again to the challenge author <a href="https://x.com/ah_p_uh">soon haari</a>, CTF organisers at Blue Water for hosting the event, and congrats to my team for getting top 10!</p>
<p>Never in my life would I have thought I would need to manually implement integer division, and I hope I never have to do it again.</p>

  <img src="./img/i-love-integer-division-fr.png"  class="center"  style="border-radius: 5px; width: 100%"  />


<p>As always, any typos/corrections/comments/whatever, feel free to DM me on discord <code>thesavageteddy</code>.</p>
<p>Thanks for reading!</p>
<ul>
<li>teddy / TheSavageTeddy</li>
</ul>

      </div></div>

  

  
    

  
</article>

    </div>

    
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>teddyctf</span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





    
  </div>

</body>

</html>